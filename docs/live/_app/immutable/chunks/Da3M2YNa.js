import{s as Ee,n as Dt,d as j,r as he,i as wt,b as ut,E as $,B as q,c as mt,e as pt,h as dt,k as nt,w as We,G as Oe,D as ne,v as R,I as ge,_ as kt,g as It,H as ee,x as Je,j as qt,C as te,a1 as ie,N as le,O as ae,z as Ze}from"./DzR6qLkJ.js";import{S as Le,i as He}from"./CbSE4UIZ.js";import{c as Ve,g as rn}from"./BmAGY9Gp.js";import{w as tt,d as ln}from"./azyml33n.js";import{b as os}from"./xwTOpLDr.js";const Ot=tt(null),Lt=tt(44100),Es=tt(""),an=tt(0),bt=tt({start:0,end:5}),Ct=tt(0),Wt=tt(null),zt=tt(null);ln(bt,e=>e.end-e.start);function rs(e){let n,t,s,r;return{c(){n=dt("div"),t=dt("canvas"),this.h()},l(l){n=mt(l,"DIV",{class:!0,role:!0,"aria-label":!0});var a=pt(n);t=mt(a,"CANVAS",{class:!0}),pt(t).forEach(j),a.forEach(j),this.h()},h(){q(t,"class","svelte-vdkqpy"),q(n,"class","waveform-container svelte-vdkqpy"),q(n,"role","application"),q(n,"aria-label","Audio waveform - click and drag to select, scroll to zoom")},m(l,a){wt(l,n,a),ut(n,t),e[14](t),e[15](n),s||(r=[$(n,"mousedown",e[2]),$(n,"mousemove",e[3]),$(n,"mouseup",e[4]),$(n,"mouseleave",e[5]),$(n,"wheel",e[6])],s=!0)},p:Dt,i:Dt,o:Dt,d(l){l&&j(n),e[14](null),e[15](null),s=!1,he(r)}}}const yt=45,$t=45;function is(e,n,t){let s,r,l,a,u,d,h,m,b;nt(e,bt,k=>t(9,l=k)),nt(e,Lt,k=>t(22,a=k)),nt(e,Ot,k=>t(10,u=k)),nt(e,Ct,k=>t(11,d=k)),nt(e,zt,k=>t(12,h=k)),nt(e,Wt,k=>t(13,m=k)),nt(e,Ve,k=>t(23,b=k));let g,w,c=null,_=0,B=0,N,M=!1,U=0;We(()=>{t(7,c=w.getContext("2d")),N=new ResizeObserver(k=>{const Y=k[0].contentRect;t(8,_=Y.width),B=Y.height,t(1,w.width=_*devicePixelRatio,w),t(1,w.height=B*devicePixelRatio,w),c&&c.scale(devicePixelRatio,devicePixelRatio),P()}),N.observe(g)}),Oe(()=>{N==null||N.disconnect()});function P(){if(!c||!u||_===0)return;const k=u,Y=a,{start:z,end:Q}=l,V=b.colors;if(t(7,c.fillStyle=getComputedStyle(g).getPropertyValue("--color-bg").trim()||"#1a1a1a",c),c.fillRect(0,0,_,B),t(7,c.fillStyle=getComputedStyle(g).getPropertyValue("--color-surface").trim()||"#2a2a2a",c),c.fillRect(0,0,yt,B),c.fillRect(_-$t,0,$t,B),t(7,c.fillStyle=V.waveform.background,c),c.fillRect(yt,0,s,B),m){const O=Math.max(m.start,z),it=Math.min(m.end,Q);if(it>O){const Z=A(O,z,Q),st=A(it,z,Q);t(7,c.fillStyle=V.selection.fill,c),c.fillRect(Z,0,st-Z,B)}}const o=Math.floor(z*Y),G=Math.ceil(Q*Y),F=(G-o)/s;let xt=0;const rt=G-o,oe=Math.max(1,Math.floor(rt/1e3));for(let O=Math.max(0,o);O<Math.min(G,k.length);O+=oe){const it=Math.abs(k[O]);it>xt&&(xt=it)}const _t=xt>.01?Math.min(.95/xt,10):1;t(7,c.strokeStyle=V.waveform.line,c),t(7,c.lineWidth=V.waveform.lineWidth,c);const Mt=B/2,ct=(B/2-4)*_t;if(c.save(),c.beginPath(),c.rect(yt,0,s,B),c.clip(),F<=1){c.beginPath();for(let O=0;O<s;O++){const it=Math.floor(o+O*F);if(it>=0&&it<k.length){const Z=yt+O,st=Mt-k[it]*ct;O===0?c.moveTo(Z,st):c.lineTo(Z,st)}}c.stroke()}else{const O=[],it=[];for(let Z=0;Z<s;Z++){const st=Math.floor(o+Z*F),vt=Math.floor(o+(Z+1)*F);let Tt=1/0,Ht=-1/0;for(let Vt=st;Vt<vt&&Vt<k.length;Vt++)if(Vt>=0){const Xt=k[Vt];Xt<Tt&&(Tt=Xt),Xt>Ht&&(Ht=Xt)}Tt!==1/0?(O.push(Tt),it.push(Ht)):(O.push(0),it.push(0))}t(7,c.fillStyle=V.waveform.line,c),c.beginPath();for(let Z=0;Z<O.length;Z++){const st=yt+Z,vt=Mt-it[Z]*ct;Z===0?c.moveTo(st,vt):c.lineTo(st,vt)}for(let Z=O.length-1;Z>=0;Z--){const st=yt+Z,vt=Mt-O[Z]*ct;c.lineTo(st,vt)}c.closePath(),c.fill()}if(t(7,c.strokeStyle="rgba(128, 128, 128, 0.3)",c),t(7,c.lineWidth=1,c),c.beginPath(),c.moveTo(yt,Mt),c.lineTo(r,Mt),c.stroke(),h!==null){const O=A(h,z,Q);O>=yt&&O<=r&&(t(7,c.strokeStyle=V.cursor,c),t(7,c.lineWidth=1,c),c.setLineDash([4,4]),c.beginPath(),c.moveTo(O,0),c.lineTo(O,B),c.stroke(),c.setLineDash([]))}const J=A(d,z,Q);J>=yt&&J<=r&&(t(7,c.strokeStyle=V.cursor,c),t(7,c.lineWidth=V.cursorWidth,c),c.beginPath(),c.moveTo(J,0),c.lineTo(J,B),c.stroke()),c.restore()}function A(k,Y,z){return yt+(k-Y)/(z-Y)*s}function D(k,Y,z){return Y+(k-yt)/s*(z-Y)}function E(k){document.activeElement instanceof HTMLInputElement&&document.activeElement.blur();const Y=w.getBoundingClientRect(),z=k.clientX-Y.left;if(z<yt||z>_-$t)return;const Q=D(z,l.start,l.end);k.shiftKey||(M=!0,U=Q,Ct.set(Q),Wt.set(null))}function C(k){const Y=w.getBoundingClientRect(),z=k.clientX-Y.left;if(z<yt||z>_-$t){zt.set(null);return}const Q=D(z,l.start,l.end);zt.set(Q),M&&(Math.abs(Q-U)>.001&&Wt.set({start:Math.min(U,Q),end:Math.max(U,Q)}),Ct.set(Q))}function H(){M=!1}function at(){M=!1,zt.set(null)}function L(k){k.preventDefault();const Y=w.getBoundingClientRect(),z=k.clientX-Y.left,Q=D(z,l.start,l.end),V=u?u.length/a:10,{start:o,end:G}=l,F=G-o;if(Math.abs(k.deltaX)>Math.abs(k.deltaY)){const ct=k.deltaX/s*F;let J=o+ct,O=G+ct;J<0&&(J=0,O=F),O>V&&(O=V,J=V-F),bt.set({start:J,end:O});return}const xt=k.deltaY>0?1.1:.91,rt=Math.max(.01,Math.min(V,F*xt)),oe=(Q-o)/F,_t=Math.max(0,Q-oe*rt),Mt=Math.min(V,_t+rt);bt.set({start:Math.max(0,Mt-rt),end:Mt})}function Ft(k){ne[k?"unshift":"push"](()=>{w=k,t(1,w)})}function Nt(k){ne[k?"unshift":"push"](()=>{g=k,t(0,g)})}return e.$$.update=()=>{e.$$.dirty&256&&(s=Math.max(0,_-yt-$t)),e.$$.dirty&256&&(r=_-$t),e.$$.dirty&16256&&c&&u&&_>0&&l&&m!==void 0&&d!==void 0&&h!==void 0&&P()},[g,w,E,C,H,at,L,c,_,l,u,d,h,m,Ft,Nt]}class Ws extends Le{constructor(n){super(),He(this,n,is,rs,Ee,{})}}const fe=tt(!1),qe=tt(null);let ce=null;const ls={"praatfan-gpl":"https://ucpresearch.github.io/praatfan-core-rs/pkg/praatfan_gpl.js",praatfan:"https://ucpresearch.github.io/praatfan-core-clean/pkg/praatfan.js"};function as(e){return e==="praatfan-local"?`${os}/wasm/praatfan/praatfan.js`:ls[e]}const cs={"praatfan-gpl":"praatfan-gpl",praatfan:"praatfan","praatfan-local":"praatfan"};async function Os(e="praatfan-local"){if(!(R(qe)===e&&ce)){fe.set(!1),ce=null;try{const t=as(e);console.log(`Loading WASM module from ${t}...`);const s=await import(t);await s.default(),(e==="praatfan"||e==="praatfan-local")&&typeof s.init=="function"&&s.init(),ce=s,qe.set(e),fe.set(!0),console.log(`WASM acoustic analysis module initialized (${e})`)}catch(t){throw console.error("Failed to initialize WASM module:",t),t}}}function Se(){if(!ce)throw new Error("WASM module not initialized. Call initWasm() first.");return ce}function us(){const e=R(qe);if(!e)throw new Error("No backend loaded. Call initWasm() first.");return e}function Jt(){const e=us();return cs[e]}function cn(e,n,t,s){return Jt()==="praatfan-gpl"?e.to_pitch(n,t,s):e.to_pitch_ac(n,t,s)}function un(e,n,t){return e.to_intensity(n,t)}function fn(e,n,t,s,r,l){return e.to_formant_burg(n,t,s,r,l)}function hn(e,n,t,s,r){return e.to_harmonicity_ac(n,t,s,r)}function _e(e,n,t,s,r){return Jt()==="praatfan-gpl"?e.to_spectrogram(n,t,s,r,"gaussian"):e.to_spectrogram(n,t,s,r)}function fs(e,n){return e.to_spectrum(n)}function mn(e){return e.times()}function dn(e){return e.values()}function pn(e,n){if(Jt()==="praatfan-gpl")return e.get_value_at_time(n,"cubic");{const s=e.times(),r=e.values();return Ce(s,r,n)}}function Bt(e,n,t){if(Jt()==="praatfan-gpl")return e.get_value_at_time(n,t,"hertz","linear");{const r=e.times(),l=e.formant_values(n);return Ce(r,l,t)}}function Et(e,n,t){if(Jt()==="praatfan-gpl")return e.get_bandwidth_at_time(n,t,"hertz","linear");{const r=e.times(),l=e.bandwidth_values(n);return Ce(r,l,t)}}function gn(e,n){if(Jt()==="praatfan-gpl")return e.get_value_at_time(n,"linear");{const s=e.times(),r=e.values();return Ce(s,r,n)}}function Pe(e){return Jt()==="praatfan-gpl"?{values:e.values(),freqMin:e.freq_min,freqMax:e.freq_max,timeMin:e.start_time,timeMax:e.start_time+(e.num_frames-1)*e.time_step,nFreqs:e.num_freq_bins,nTimes:e.num_frames}:{values:e.values(),freqMin:e.freq_min(),freqMax:e.freq_max(),timeMin:e.time_min(),timeMax:e.time_max(),nFreqs:e.n_freqs(),nTimes:e.n_times()}}function Ce(e,n,t){if(e.length===0)return NaN;if(e.length===1)return n[0];const s=e.length>1?e[1]-e[0]:1,r=e[0],l=(t-r)/s;if(l<=0)return n[0];if(l>=e.length-1)return n[e.length-1];const a=Math.floor(l),u=a+1,d=l-a,h=n[a],m=n[u];return isNaN(h)&&isNaN(m)?NaN:isNaN(h)?m:isNaN(m)?h:h+d*(m-h)}const ke=tt(!1),ot=tt(0),se=tt(null),yn=tt({timeStep:.01,pitchFloor:75,pitchCeiling:600,maxFormant:5500,numFormants:5}),jt=60;async function Ls(){const e=R(Ot),n=R(Lt),t=R(fe);if(!e||!t){console.warn("Cannot run analysis: audio or WASM not ready");return}const s=R(an);if(s>jt){console.log(`Audio duration ${s.toFixed(1)}s exceeds ${jt}s limit, skipping analysis`),se.set(null);return}ke.set(!0),ot.set(0);try{const r=R(yn),l=rn(),a=Se(),u=new a.Sound(e,n);try{ot.set(10);const d=cn(u,r.timeStep,r.pitchFloor,r.pitchCeiling);ot.set(25);const h=un(u,r.pitchFloor,r.timeStep);ot.set(40);const m=fn(u,r.timeStep,r.numFormants,l.maxFormant,.025,50);ot.set(55);const b=hn(u,r.timeStep,r.pitchFloor,.1,4.5);ot.set(70);const g=Array.from(mn(d)),w=Array.from(dn(d));ot.set(75);const c=_e(u,.005,5e3,.002,20);ot.set(85);const _=bn(e,n,g,w,a),B=Pe(c);ot.set(95);const N={times:g,pitch:w.map(M=>isNaN(M)||M===0?null:M),intensity:g.map(M=>{const U=pn(h,M);return isNaN(U)?null:U}),formants:{f1:g.map(M=>lt(Bt(m,1,M))),f2:g.map(M=>lt(Bt(m,2,M))),f3:g.map(M=>lt(Bt(m,3,M))),f4:g.map(M=>lt(Bt(m,4,M))),b1:g.map(M=>lt(Et(m,1,M))),b2:g.map(M=>lt(Et(m,2,M))),b3:g.map(M=>lt(Et(m,3,M))),b4:g.map(M=>lt(Et(m,4,M)))},harmonicity:g.map(M=>lt(gn(b,M))),cog:_.cog,spectralTilt:_.spectralTilt,a1p0:_.a1p0,spectrogram:B};d.free(),h.free(),m.free(),b.free(),c.free(),ot.set(100),se.set(N)}finally{u.free()}}catch(r){throw console.error("Analysis failed:",r),r}finally{ke.set(!1)}}function lt(e){return isNaN(e)||e===0?null:e}async function hs(e,n){const t=R(Ot),s=R(Lt),r=R(fe);if(!t||!r){console.warn("Cannot run analysis: audio or WASM not ready");return}const l=n-e;if(l>jt){console.log(`Range ${l.toFixed(1)}s exceeds ${jt}s limit`);return}ke.set(!0),ot.set(0);try{const a=R(yn),u=rn(),d=Se(),h=.1,m=Math.max(0,e-h),b=Math.min(t.length/s,n+h),g=Math.floor(m*s),w=Math.ceil(b*s),c=t.slice(g,w),_=new d.Sound(c,s);try{ot.set(15);const B=cn(_,a.timeStep,a.pitchFloor,a.pitchCeiling);ot.set(30);const N=un(_,a.pitchFloor,a.timeStep);ot.set(45);const M=fn(_,a.timeStep,a.numFormants,u.maxFormant,.025,50);ot.set(60);const U=hn(_,a.timeStep,a.pitchFloor,.1,4.5);ot.set(75);const P=Array.from(mn(B)),A=P.map(L=>L+m),D=Array.from(dn(B));ot.set(85);const E=_e(_,.005,5e3,.002,20),C=bn(c,s,P,D,d),H=Pe(E);H.timeMin=m,H.timeMax=b,ot.set(95);const at={times:A,pitch:D.map(L=>isNaN(L)||L===0?null:L),intensity:A.map((L,Ft)=>{const Nt=pn(N,P[Ft]);return isNaN(Nt)?null:Nt}),formants:{f1:P.map(L=>lt(Bt(M,1,L))),f2:P.map(L=>lt(Bt(M,2,L))),f3:P.map(L=>lt(Bt(M,3,L))),f4:P.map(L=>lt(Bt(M,4,L))),b1:P.map(L=>lt(Et(M,1,L))),b2:P.map(L=>lt(Et(M,2,L))),b3:P.map(L=>lt(Et(M,3,L))),b4:P.map(L=>lt(Et(M,4,L)))},harmonicity:P.map(L=>lt(gn(U,L))),cog:C.cog,spectralTilt:C.spectralTilt,a1p0:C.a1p0,spectrogram:H};B.free(),N.free(),M.free(),U.free(),E.free(),ot.set(100),se.set(at),console.log(`Analysis completed for range ${e.toFixed(1)}s - ${n.toFixed(1)}s`)}finally{_.free()}}catch(a){throw console.error("Range analysis failed:",a),a}finally{ke.set(!1)}}function bn(e,n,t,s,r){const u=Math.floor(.025*n),d=[],h=[],m=[];for(let b=0;b<t.length;b++){const g=t[b],w=s[b],c=Math.max(0,Math.floor((g-.0125)*n)),_=Math.min(e.length,c+u);if(_-c<u/2){d.push(null),h.push(null),m.push(null);continue}try{const B=e.slice(c,_),N=new r.Sound(B,n),M=fs(N,!0),U=M.get_center_of_gravity(2);d.push(isNaN(U)||U<=0?null:U);const P=M.get_band_energy(0,500),A=M.get_band_energy(2e3,4e3);if(P>0&&A>0){const D=10*Math.log10(P)-10*Math.log10(A);h.push(isNaN(D)?null:D)}else h.push(null);if(w&&!isNaN(w)&&w>0){const D=M.get_band_energy(w*.9,w*1.1),E=M.get_band_energy(200,300);if(D>0&&E>0){const C=10*Math.log10(D)-10*Math.log10(E);m.push(isNaN(C)?null:C)}else m.push(null)}else m.push(null);M.free(),N.free()}catch{d.push(null),h.push(null),m.push(null)}}return{cog:d,spectralTilt:h,a1p0:m}}function Hs(){se.set(null),ot.set(0)}const me=tt(!1),ze=tt("full");let ue=null,At=null,wn=0,ve=0,Be=0,Te=null;function ms(){return ue||(ue=new AudioContext),ue}function ds(){const e=R(Ot),n=R(Lt);if(!e)return;e.length/n;const t=R(Ct),s=R(Wt),r=R(bt);let l,a;s&&s.end>s.start?(l=s.start,a=s.end,ze.set("selection")):(l=t,a=r.end,ze.set("visible")),Xe(l,a)}function Xe(e,n){Ne();const t=R(Ot),s=R(Lt);if(!t)return;const r=ms(),a=Math.ceil(.3*s),u=t.length+a,d=r.createBuffer(1,u,s),h=d.getChannelData(0);for(let m=0;m<t.length;m++)h[m]=t[m];At=r.createBufferSource(),At.buffer=d,At.connect(r.destination),ve=Math.max(0,e),Be=Math.min(t.length/s,n),wn=r.currentTime,At.start(0,ve,Be-ve),me.set(!0),At.onended=()=>{Ne()},Mn()}function Vs(){const e=R(bt);ze.set("visible"),Xe(e.start,e.end)}function xn(){At&&(At.stop(),At.disconnect(),At=null),Te!==null&&(cancelAnimationFrame(Te),Te=null),me.set(!1)}function Ne(){xn();const e=R(Wt);e&&Ct.set(e.start)}function Xs(){R(me)?xn():ds()}function Mn(){if(!R(me)||!ue)return;const e=ue.currentTime-wn,n=ve+e;if(n>=Be){Ne();return}Ct.set(n),Te=requestAnimationFrame(Mn)}function ps(e){const n=e.split(/\r?\n/);let t=0;function s(){for(;t<n.length&&n[t].trim()==="";)t++;return t<n.length?n[t++].trim():""}const r=s(),l=r==='"ooTextFile"'||!r.includes("=");return t=0,l?gs(n):ys(n)}function gs(e){let n=0;const t=[];function s(){for(;n<e.length&&e[n].trim()==="";)n++;return n<e.length?e[n++].trim():""}function r(){return s().replace(/^"|"$/g,"")}function l(){return parseFloat(s())}r(),r();const a=l(),u=l();s();const d=l();for(let h=0;h<d;h++){const m=r(),b=r();l(),l();const g=l(),w={name:b,type:m==="IntervalTier"?"interval":"point",intervals:[]};for(let c=0;c<g;c++)if(w.type==="interval"){const _=l(),B=l(),N=r();w.intervals.push({start:_,end:B,text:N})}else{const _=l(),B=r();w.intervals.push({start:_,end:_,text:B})}t.push(w)}return{tiers:t,xmin:a,xmax:u}}function ys(e){let n=0;const t=[];function s(){for(;n<e.length&&e[n].trim()==="";)n++;return n<e.length?e[n++].trim():""}function r(h){const m=h.match(/=\s*(.+)$/);return m?m[1].trim():h.trim()}function l(h){return parseFloat(r(h))}function a(h){return r(h).replace(/^"|"$/g,"")}s(),s();let u=0,d=0;for(;n<e.length;){const h=s();if(h.startsWith("xmin"))u=l(h);else if(h.startsWith("xmax"))d=l(h);else if(h.includes("size =")){const m=l(h);s();for(let b=0;b<m;b++){s();const g=s(),w=a(g),c=s(),_=a(c),B=s();l(B);const N=s();l(N);const M=s(),U=l(M),P={name:_,type:w==="IntervalTier"?"interval":"point",intervals:[]};for(let A=0;A<U;A++)if(s(),P.type==="interval"){const D=l(s()),E=l(s()),C=a(s());P.intervals.push({start:D,end:E,text:C})}else{const D=l(s()),E=a(s());P.intervals.push({start:D,end:D,text:E})}t.push(P)}break}}return{tiers:t,xmin:u,xmax:d}}function bs(e,n,t){const s=[];s.push('File type = "ooTextFile"'),s.push('Object class = "TextGrid"'),s.push(""),s.push(`xmin = ${n}`),s.push(`xmax = ${t}`),s.push("tiers? <exists>"),s.push(`size = ${e.length}`),s.push("item []:");for(let r=0;r<e.length;r++){const l=e[r];s.push(`    item [${r+1}]:`),s.push(`        class = "${l.type==="interval"?"IntervalTier":"TextTier"}"`),s.push(`        name = "${Ie(l.name)}"`);const a=l.intervals.length>0?l.intervals[0].start:n,u=l.intervals.length>0?l.intervals[l.intervals.length-1].end:t;if(s.push(`        xmin = ${a}`),s.push(`        xmax = ${u}`),l.type==="interval"){s.push(`        intervals: size = ${l.intervals.length}`);for(let d=0;d<l.intervals.length;d++){const h=l.intervals[d];s.push(`        intervals [${d+1}]:`),s.push(`            xmin = ${h.start}`),s.push(`            xmax = ${h.end}`),s.push(`            text = "${Ie(h.text)}"`)}}else{s.push(`        points: size = ${l.intervals.length}`);for(let d=0;d<l.intervals.length;d++){const h=l.intervals[d];s.push(`        points [${d+1}]:`),s.push(`            number = ${h.start}`),s.push(`            mark = "${Ie(h.text)}"`)}}}return s.join(`
`)}function Ie(e){return e.replace(/"/g,'""')}const ws=50,Ae=tt([]),De=tt([]);let Gt=null,Ut=null;function je(){if(!Gt)return[];let e=[];return Gt.subscribe(t=>{e=t})(),e}function Ge(){if(!Ut)return[];let e=[];return Ut.subscribe(t=>{e=t})(),e}function js(e,n){Gt=e,Ut=n}function Zt(){const e={tiers:JSON.parse(JSON.stringify(je())),dataPoints:JSON.parse(JSON.stringify(Ge()))};Ae.update(n=>{const t=[...n,e];return t.length>ws&&t.shift(),t}),De.set([])}function Gs(){const e=R(Ae);if(e.length===0)return!1;const n={tiers:JSON.parse(JSON.stringify(je())),dataPoints:JSON.parse(JSON.stringify(Ge()))};De.update(s=>[...s,n]);const t=e[e.length-1];return Ae.update(s=>s.slice(0,-1)),Gt&&Gt.set(t.tiers),Ut&&Ut.set(t.dataPoints),!0}function Us(){const e=R(De);if(e.length===0)return!1;const n={tiers:JSON.parse(JSON.stringify(je())),dataPoints:JSON.parse(JSON.stringify(Ge()))};Ae.update(s=>[...s,n]);const t=e[e.length-1];return De.update(s=>s.slice(0,-1)),Gt&&Gt.set(t.tiers),Ut&&Ut.set(t.dataPoints),!0}const ft=tt([]),Yt=tt(0);ln([ft,Yt],([e,n])=>e[n]||null);const xs=tt(null);function Ys(e){try{const{tiers:n}=ps(e);Zt(),ft.set(n),Yt.set(0),xs.set(null)}catch(n){throw console.error("Failed to parse TextGrid:",n),n}}function Js(){const e=R(Ot),n=R(Lt),t=e?e.length/n:1;return bs(R(ft),0,t)}function Ms(e,n="interval"){const t=R(Ot),s=R(Lt),r=t?t.length/s:1,l={name:e,type:n,intervals:n==="interval"?[{start:0,end:r,text:""}]:[]};ft.update(a=>[...a,l])}function Zs(e){ft.update(t=>t.filter((s,r)=>r!==e));const n=R(Yt);n>=e&&n>0&&Yt.update(t=>t-1)}function Ks(e,n){ft.update(t=>t.map((s,r)=>r===e?{...s,name:n}:s))}const Ke=.05;function vn(e,n,t){for(let s=0;s<n;s++){const r=t[s];if(r.type==="interval")for(const l of r.intervals){if(Math.abs(l.start-e)<=Ke)return l.start;if(Math.abs(l.end-e)<=Ke)return l.end}}return null}function Qs(e){const n=R(Yt),t=R(ft);if(n<0||n>=t.length)return;const s=t[n];if(s.type!=="interval")return;const r=vn(e,n,t),l=r!==null?r:e,a=s.intervals.findIndex(m=>l>m.start&&l<m.end);if(a===-1)return;Zt();const u=s.intervals[a],d={start:u.start,end:l,text:u.text},h={start:l,end:u.end,text:""};ft.update(m=>{const b=[...m];return b[n]={...b[n],intervals:[...b[n].intervals.slice(0,a),d,h,...b[n].intervals.slice(a+1)]},b})}function $s(e){const n=R(Yt),t=R(ft);n<0||n>=t.length||e<=0||t[n].type!=="interval"||(Zt(),ft.update(r=>{const l=[...r],a=[...l[n].intervals],u=a[e-1],d=a[e],h={start:u.start,end:d.end,text:u.text||d.text};return a.splice(e-1,2,h),l[n]={...l[n],intervals:a},l}))}function to(e,n,t){const s=R(ft);if(e<s.length&&n<s[e].intervals.length){if(s[e].intervals[n].text===t)return;Zt()}ft.update(r=>{const l=[...r];return e<l.length&&n<l[e].intervals.length&&(l[e]={...l[e],intervals:l[e].intervals.map((a,u)=>u===n?{...a,text:t}:a)}),l})}function eo(e,n){const t=R(Yt),s=R(ft);if(t<0||t>=s.length||e<=0)return;const r=s[t],l=r.intervals[e-1],a=r.intervals[e],u=vn(n,t,s),d=u!==null?u:n;d<=l.start||d>=a.end||ft.update(h=>{const m=[...h],b=[...m[t].intervals];return b[e-1]={...b[e-1],end:d},b[e]={...b[e],start:d},m[t]={...m[t],intervals:b},m})}function no(){if(R(ft).length===0){const n=R(Ve);for(const t of n.annotation.defaultTiers)Ms(t)}}const Kt=tt([]),ye=tt(null),be=tt(null);let Tn=1;function Sn(e,n){Zt();const t=_n(e),s=Ue(e),r={id:Tn++,time:e,frequency:n,acousticValues:t,annotationIntervals:s};return Kt.update(l=>[...l,r]),r}function vs(e){Zt();let n=null;return Kt.update(t=>{const s=t.findIndex(r=>r.id===e);return s!==-1?(n=t[s],[...t.slice(0,s),...t.slice(s+1)]):t}),n}function Ts(e,n,t){let s=!1;return Kt.update(r=>r.map(l=>{if(l.id===e){s=!0;const a=_n(n),u=Ue(n);return{...l,time:n,frequency:t,acousticValues:a,annotationIntervals:u}}return l})),s}function we(e,n,t=.02,s=100){const r=R(Kt);let l=null,a=1/0;for(const u of r){const d=Math.abs(u.time-e),h=Math.abs(u.frequency-n);if(d<=t&&h<=s){const m=(d/t)**2+(h/s)**2;m<a&&(a=m,l=u)}}return l}function Ss(){Kt.set([]),Tn=1}function _n(e){const n=R(se);if(!n)return{};const{times:t}=n;let s=0,r=1/0;for(let l=0;l<t.length;l++){const a=Math.abs(t[l]-e);a<r&&(r=a,s=l)}return{Pitch:n.pitch[s],Intensity:n.intensity[s],F1:n.formants.f1[s],F2:n.formants.f2[s],F3:n.formants.f3[s],F4:n.formants.f4[s],B1:n.formants.b1[s],B2:n.formants.b2[s],B3:n.formants.b3[s],B4:n.formants.b4[s],HNR:n.harmonicity[s],CoG:n.cog[s],SpectralTilt:n.spectralTilt[s],"A1-P0":n.a1p0[s]}}function Ue(e){const n=R(ft),t={};for(const s of n)for(const r of s.intervals)if(e>=r.start&&e<r.end){t[s.name]=r.text;break}return t}function _s(e,n){if(!n)return e;const t=[];for(const s of e){const r=s.toLowerCase();r==="pitch"||r==="f0"?n.showPitch&&t.push(s):r.startsWith("f")&&/^f[1-4]$/.test(r)||r.startsWith("b")&&/^b[1-4]$/.test(r)?n.showFormants&&t.push(s):r==="intensity"?n.showIntensity&&t.push(s):r==="hnr"||r==="harmonicity"?n.showHNR&&t.push(s):r==="cog"||r==="centerofgravity"?n.showCoG&&t.push(s):r==="spectraltilt"||r==="tilt"?n.showSpectralTilt&&t.push(s):r==="a1p0"||r==="a1-p0"?n.showA1P0&&t.push(s):t.push(s)}return t}function so(e){const n=R(Kt),t=R(ft);if(n.length===0)return`time	frequency
`;const s=new Set;for(const b of n)Object.keys(b.acousticValues).forEach(g=>s.add(g));const r=Array.from(s).sort(),l=_s(r,e),a=t.map(b=>b.name),u=["time","frequency",...l,...a],h=[...n].sort((b,g)=>b.time-g.time).map(b=>{const g=[b.time.toFixed(4),b.frequency.toFixed(1)];for(const c of l){const _=b.acousticValues[c];g.push(_!=null?_.toFixed(2):"")}const w=Ue(b.time);for(const c of a)g.push(w[c]||"");return g});return[u.join("	"),...h.map(b=>b.join("	"))].join(`
`)}function oo(e){const n=e.trim().split(`
`);if(n.length<2)return-1;const t=n[0].split("	").map(a=>a.trim().toLowerCase()),s=t.indexOf("time"),r=t.indexOf("frequency");if(s===-1||r===-1)return-1;Ss();let l=0;for(let a=1;a<n.length;a++){const u=n[a].trim();if(!u)continue;const d=u.split("	"),h=parseFloat(d[s]),m=parseFloat(d[r]);!isNaN(h)&&!isNaN(m)&&(Sn(h,m),l++)}return l}function Qe(e){let n,t="Computing spectrogram...";return{c(){n=dt("div"),n.textContent=t,this.h()},l(s){n=mt(s,"DIV",{class:!0,"data-svelte-h":!0}),ee(n)!=="svelte-vvjva"&&(n.textContent=t),this.h()},h(){q(n,"class","computing svelte-1r84lea")},m(s,r){wt(s,n,r)},d(s){s&&j(n)}}}function $e(e){let n,t,s;function r(u,d){return u[11]?ks:Ps}let l=r(e),a=l(e);return{c(){n=dt("button"),a.c(),this.h()},l(u){n=mt(u,"BUTTON",{class:!0,style:!0,title:!0});var d=pt(n);a.l(d),d.forEach(j),this.h()},h(){q(n,"class","play-selection-btn svelte-1r84lea"),te(n,"left",e[10]+4+"px"),q(n,"title","Play selection")},m(u,d){wt(u,n,d),a.m(n,null),t||(s=[$(n,"mousedown",kt(e[56])),$(n,"click",kt(e[21]))],t=!0)},p(u,d){l!==(l=r(u))&&(a.d(1),a=l(u),a&&(a.c(),a.m(n,null))),d[0]&1024&&te(n,"left",u[10]+4+"px")},d(u){u&&j(n),a.d(),t=!1,he(s)}}}function Ps(e){let n,t;return{c(){n=ae("svg"),t=ae("path"),this.h()},l(s){n=le(s,"svg",{viewBox:!0,fill:!0,width:!0,height:!0});var r=pt(n);t=le(r,"path",{d:!0}),pt(t).forEach(j),r.forEach(j),this.h()},h(){q(t,"d","M8 5v14l11-7z"),q(n,"viewBox","0 0 24 24"),q(n,"fill","currentColor"),q(n,"width","14"),q(n,"height","14")},m(s,r){wt(s,n,r),ut(n,t)},d(s){s&&j(n)}}}function ks(e){let n,t,s;return{c(){n=ae("svg"),t=ae("rect"),s=ae("rect"),this.h()},l(r){n=le(r,"svg",{viewBox:!0,fill:!0,width:!0,height:!0});var l=pt(n);t=le(l,"rect",{x:!0,y:!0,width:!0,height:!0}),pt(t).forEach(j),s=le(l,"rect",{x:!0,y:!0,width:!0,height:!0}),pt(s).forEach(j),l.forEach(j),this.h()},h(){q(t,"x","6"),q(t,"y","4"),q(t,"width","4"),q(t,"height","16"),q(s,"x","14"),q(s,"y","4"),q(s,"width","4"),q(s,"height","16"),q(n,"viewBox","0 0 24 24"),q(n,"fill","currentColor"),q(n,"width","14"),q(n,"height","14")},m(r,l){wt(r,n,l),ut(n,t),ut(n,s)},d(r){r&&j(n)}}}function tn(e){let n,t='<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"></path></svg>',s,r;return{c(){n=dt("button"),n.innerHTML=t,this.h()},l(l){n=mt(l,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ee(n)!=="svelte-9j0vt3"&&(n.innerHTML=t),this.h()},h(){q(n,"class","zoom-btn svelte-1r84lea"),q(n,"title","Zoom to selection")},m(l,a){wt(l,n,a),s||(r=[$(n,"mousedown",kt(e[53])),$(n,"click",kt(e[24]))],s=!0)},p:Dt,d(l){l&&j(n),s=!1,he(r)}}}function en(e){let n,t,s,r,l="Remove data point",a,u;return{c(){n=dt("div"),t=qt(),s=dt("div"),r=dt("button"),r.textContent=l,this.h()},l(d){n=mt(d,"DIV",{class:!0}),pt(n).forEach(j),t=It(d),s=mt(d,"DIV",{class:!0,style:!0});var h=pt(s);r=mt(h,"BUTTON",{class:!0,"data-svelte-h":!0}),ee(r)!=="svelte-8fgbhx"&&(r.textContent=l),h.forEach(j),this.h()},h(){q(n,"class","context-menu-backdrop svelte-1r84lea"),q(r,"class","context-menu-item svelte-1r84lea"),q(s,"class","context-menu svelte-1r84lea"),te(s,"left",e[9].x+"px"),te(s,"top",e[9].y+"px")},m(d,h){wt(d,n,h),wt(d,t,h),wt(d,s,h),ut(s,r),a||(u=[$(n,"click",e[18]),$(r,"click",e[19])],a=!0)},p(d,h){h[0]&512&&te(s,"left",d[9].x+"px"),h[0]&512&&te(s,"top",d[9].y+"px")},d(d){d&&(j(n),j(t),j(s)),a=!1,he(u)}}}function Ns(e){let n,t,s,r,l,a,u,d='<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></svg>',h,m,b='<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M19 13H5v-2h14v2z"></path></svg>',g,w,c,_='<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M4 4h6v6H4zm10 0h6v6h-6zM4 14h6v6H4zm10 0h6v6h-6z"></path></svg>',B,N,M,U,P=(e[7]||!e[0]&&!e[1]&&!e[2])&&Qe(),A=e[3]&&e[0]&&$e(e),D=e[3]&&tn(e),E=e[9]&&en(e);return{c(){n=dt("div"),P&&P.c(),t=qt(),s=dt("canvas"),r=qt(),A&&A.c(),l=qt(),a=dt("div"),u=dt("button"),u.innerHTML=d,h=qt(),m=dt("button"),m.innerHTML=b,g=qt(),D&&D.c(),w=qt(),c=dt("button"),c.innerHTML=_,B=qt(),E&&E.c(),N=Je(),this.h()},l(C){n=mt(C,"DIV",{class:!0,role:!0,"aria-label":!0});var H=pt(n);P&&P.l(H),t=It(H),s=mt(H,"CANVAS",{class:!0}),pt(s).forEach(j),r=It(H),A&&A.l(H),l=It(H),a=mt(H,"DIV",{class:!0});var at=pt(a);u=mt(at,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ee(u)!=="svelte-r6msr3"&&(u.innerHTML=d),h=It(at),m=mt(at,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ee(m)!=="svelte-q25joc"&&(m.innerHTML=b),g=It(at),D&&D.l(at),w=It(at),c=mt(at,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ee(c)!=="svelte-dflweb"&&(c.innerHTML=_),at.forEach(j),H.forEach(j),B=It(C),E&&E.l(C),N=Je(),this.h()},h(){q(s,"class","svelte-1r84lea"),q(u,"class","zoom-btn svelte-1r84lea"),q(u,"title","Zoom in"),q(m,"class","zoom-btn svelte-1r84lea"),q(m,"title","Zoom out"),q(c,"class","zoom-btn svelte-1r84lea"),q(c,"title","Zoom to fit"),q(a,"class","zoom-controls svelte-1r84lea"),q(n,"class","spectrogram-container svelte-1r84lea"),q(n,"role","application"),q(n,"aria-label","Spectrogram - click and drag to select, scroll to zoom, double-click to add data point"),ge(n,"grabbing",e[8]),ge(n,"can-grab",e[4]!==null&&!e[8])},m(C,H){wt(C,n,H),P&&P.m(n,null),ut(n,t),ut(n,s),e[58](s),ut(n,r),A&&A.m(n,null),ut(n,l),ut(n,a),ut(a,u),ut(a,h),ut(a,m),ut(a,g),D&&D.m(a,null),ut(a,w),ut(a,c),e[59](n),wt(C,B,H),E&&E.m(C,H),wt(C,N,H),M||(U=[$(window,"keydown",e[57]),$(u,"mousedown",kt(e[55])),$(u,"click",kt(e[22])),$(m,"mousedown",kt(e[54])),$(m,"click",kt(e[23])),$(c,"mousedown",kt(e[52])),$(c,"click",kt(e[25])),$(n,"mousedown",e[12]),$(n,"mousemove",e[13]),$(n,"mouseup",e[14]),$(n,"mouseleave",e[15]),$(n,"dblclick",e[16]),$(n,"contextmenu",e[17]),$(n,"wheel",e[20])],M=!0)},p(C,H){C[7]||!C[0]&&!C[1]&&!C[2]?P||(P=Qe(),P.c(),P.m(n,t)):P&&(P.d(1),P=null),C[3]&&C[0]?A?A.p(C,H):(A=$e(C),A.c(),A.m(n,l)):A&&(A.d(1),A=null),C[3]?D?D.p(C,H):(D=tn(C),D.c(),D.m(a,w)):D&&(D.d(1),D=null),H[0]&256&&ge(n,"grabbing",C[8]),H[0]&272&&ge(n,"can-grab",C[4]!==null&&!C[8]),C[9]?E?E.p(C,H):(E=en(C),E.c(),E.m(N.parentNode,N)):E&&(E.d(1),E=null)},i:Dt,o:Dt,d(C){C&&(j(n),j(B),j(N)),P&&P.d(),e[58](null),A&&A.d(),D&&D.d(),e[59](null),E&&E.d(C),M=!1,he(U)}}}const nn=70,xe=0,Me=500,ht=45,St=45;function sn(e){const{values:n,nFreqs:t,nTimes:s}=e;if(s<=0||t<=0||!n||n.length===0)return console.warn("Invalid spectrogram data:",{nTimes:s,nFreqs:t,valuesLength:n==null?void 0:n.length}),null;const r=new ImageData(s,t);let l=-1/0;for(let h=0;h<n.length;h++)n[h]>l&&(l=n[h]);const a=10*Math.log10(l+1e-10);for(let h=0;h<s;h++)for(let m=0;m<t;m++){const b=n[m*s+h],g=10*Math.log10(b+1e-10),w=Math.max(0,Math.min(1,(g-(a-nn))/nn)),c=Math.round(255*(1-w)),_=((t-1-m)*s+h)*4;r.data[_]=c,r.data[_+1]=c,r.data[_+2]=c,r.data[_+3]=255}const u=document.createElement("canvas");return u.width=s,u.height=t,u.getContext("2d").putImageData(r,0,0),{imageData:r,canvas:u}}function As(e,n,t){let s,r,l,a,u,d,h,m,b,g,w,c,_,B,N,M,U,P,A,D,E;nt(e,Lt,i=>t(70,m=i)),nt(e,Ot,i=>t(43,b=i)),nt(e,Wt,i=>t(3,g=i)),nt(e,bt,i=>t(44,w=i)),nt(e,me,i=>t(11,c=i)),nt(e,ye,i=>t(4,_=i)),nt(e,Kt,i=>t(45,B=i)),nt(e,se,i=>t(46,N=i)),nt(e,Ve,i=>t(71,M=i)),nt(e,Ct,i=>t(47,U=i)),nt(e,zt,i=>t(48,P=i)),nt(e,fe,i=>t(49,A=i)),nt(e,be,i=>t(50,D=i)),nt(e,an,i=>t(51,E=i));let{showPitch:C=!0}=n,{showFormants:H=!0}=n,{showIntensity:at=!1}=n,{showHNR:L=!1}=n,{showCoG:Ft=!1}=n,{showSpectralTilt:Nt=!1}=n,{showA1P0:k=!1}=n,{showDataPoints:Y=!0}=n,{maxFreq:z=5e3}=n,Q,V,o=null,G=0,F=0,xt,rt=null,oe=null,_t=null,Mt=!1,ct=null,J=null,O=null,it=!1,Z=0,st=!1,vt=null,Tt=null,Ht=null;function Vt(i,f){O&&clearTimeout(O);const p=f-i;if(r&&!rt){if(p>jt){t(1,ct=null),J=null;return}if(J&&(Math.min(f,J.end)-Math.max(i,J.start))/p>.9)return;O=setTimeout(async()=>{await hs(i,f),Xt(i,f)},300);return}if(!rt)return;if((rt.timeMax-rt.timeMin)/p<2){t(1,ct=null),J=null;return}J&&(Math.min(f,J.end)-Math.max(i,J.start))/p>.9||(O=setTimeout(()=>{Xt(i,f)},300))}async function Xt(i,f){if(!b||!A||!rt&&!r)return;const p=Se(),S=(f-i)*.05,y=Math.max(0,i-S),v=Math.min(b.length/m,f+S),x=Math.floor(y*m),T=Math.ceil(v*m),I=b.slice(x,T),W=new p.Sound(I,m);try{const X=Math.max(.001,(v-y)/(u*2)),et=_e(W,.005,z,X,20),K=Pe(et),Rt={values:K.values,freqMin:K.freqMin,freqMax:K.freqMax,timeMin:y,timeMax:v,nFreqs:K.nFreqs,nTimes:K.nTimes},Pt=sn(Rt);Pt&&(t(1,ct=Pt.canvas),J={start:y,end:v}),et.free(),de()}finally{W.free()}}We(()=>{t(35,o=V.getContext("2d")),xt=new ResizeObserver(i=>{const f=i[0].contentRect;t(36,G=f.width),F=f.height,t(6,V.width=G*devicePixelRatio,V),t(6,V.height=F*devicePixelRatio,V),o&&o.scale(devicePixelRatio,devicePixelRatio),de()}),xt.observe(Q)}),Oe(()=>{xt==null||xt.disconnect(),O&&clearTimeout(O)});async function Pn(){if(!b||!A)return;t(7,Mt=!0),await Ze();const i=Se(),f=new i.Sound(b,m);try{const p=_e(f,.005,z,.002,20),S=Pe(p);t(0,rt={values:S.values,freqMin:S.freqMin,freqMax:S.freqMax,timeMin:S.timeMin,timeMax:S.timeMax,nFreqs:S.nFreqs,nTimes:S.nTimes}),t(38,Ht=z),t(1,ct=null),J=null;const y=sn(rt);y&&(oe=y.imageData,t(37,_t=y.canvas)),p.free(),await Ze();const v=()=>{G>0&&o?de():requestAnimationFrame(v)};requestAnimationFrame(v)}finally{f.free(),t(7,Mt=!1)}}function de(){if(!o||G===0)return;const{start:i,end:f}=w,p=M.colors;t(35,o.fillStyle=getComputedStyle(Q).getPropertyValue("--color-bg").trim()||"#1a1a1a",o),o.fillRect(0,0,G,F),t(35,o.fillStyle=getComputedStyle(Q).getPropertyValue("--color-surface").trim()||"#2a2a2a",o),o.fillRect(0,0,ht,F),o.fillRect(G-St,0,St,F);const S=ct&&J&&i>=J.start&&f<=J.end;if(l&&!S)t(35,o.fillStyle="rgba(255, 255, 255, 0.6)",o),t(35,o.font="14px sans-serif",o),t(35,o.textAlign="center",o),t(35,o.textBaseline="middle",o),o.fillText("Zoom in for spectrogram",ht+u/2,F/2);else if(S&&ct&&J){const x=ct,T=J.start,I=J.end,W=x.width,X=x.height,et=Math.floor((i-T)/(I-T)*W),K=Math.ceil((f-i)/(I-T)*W);t(35,o.imageSmoothingEnabled=!0,o),o.drawImage(x,Math.max(0,et),0,Math.min(K,W-et),X,ht,0,u,F)}else if(rt&&_t){const{timeMin:x,timeMax:T,nTimes:I,nFreqs:W,freqMax:X}=rt,et=Math.floor((i-x)/(T-x)*I),K=Math.ceil((f-i)/(T-x)*I),Rt=Math.min(1,z/X),Pt=Math.floor(W*Rt),Qt=W-Pt;t(35,o.imageSmoothingEnabled=!1,o),o.drawImage(_t,Math.max(0,et),Qt,Math.min(K,I-et),Pt,ht,0,u,F)}if(g){const x=Math.max(g.start,i),T=Math.min(g.end,f);if(T>x){const I=gt(x,i,f),W=gt(T,i,f);t(35,o.fillStyle=p.selection.fill,o),o.fillRect(I,0,W-I,F)}}if(P!==null){const x=gt(P,i,f);x>=ht&&x<=d&&(t(35,o.strokeStyle=p.cursor,o),t(35,o.lineWidth=1,o),o.setLineDash([4,4]),o.beginPath(),o.moveTo(x,0),o.lineTo(x,F),o.stroke(),o.setLineDash([]))}const v=gt(U,i,f);v>=ht&&v<=d&&(t(35,o.strokeStyle=p.cursor,o),t(35,o.lineWidth=p.cursorWidth,o),o.beginPath(),o.moveTo(v,0),o.lineTo(v,F),o.stroke()),N&&(C&&An(i,f),H&&Dn(i,f),at&&Cn(i,f),L&&Fn(i,f),Ft&&Rn(i,f),Nt&&In(i,f),k&&qn(i,f)),Y&&zn(i,f),kn(),C&&Nn()}function kn(){if(!o)return;t(35,o.fillStyle="rgba(255, 255, 255, 0.8)",o),t(35,o.font="10px sans-serif",o),t(35,o.textAlign="right",o);const i=z<=5e3?1e3:z<=7500?1500:2e3;for(let f=0;f<=z;f+=i){const p=F-f/z*F,S=f>=1e3?`${f/1e3}k`:`${f}`;o.fillText(S,ht-4,p+3),t(35,o.strokeStyle="rgba(255, 255, 255, 0.3)",o),t(35,o.lineWidth=1,o),o.beginPath(),o.moveTo(ht-2,p),o.lineTo(ht,p),o.stroke()}o.save(),o.translate(12,F/2),o.rotate(-Math.PI/2),t(35,o.textAlign="center",o),t(35,o.fillStyle="rgba(255, 255, 255, 0.6)",o),t(35,o.font="9px sans-serif",o),o.fillText("Frequency (Hz)",0,0),o.restore()}function Nn(){if(!o)return;t(35,o.fillStyle="#60a5fa",o),t(35,o.font="10px sans-serif",o),t(35,o.textAlign="left",o);const i=100;for(let f=0;f<=Me;f+=i){const p=Re(f);o.fillText(`${f}`,G-St+4,p+3),t(35,o.strokeStyle="rgba(96, 165, 250, 0.3)",o),t(35,o.lineWidth=1,o),o.beginPath(),o.moveTo(G-St,p),o.lineTo(G-St+2,p),o.stroke()}o.save(),o.translate(G-8,F/2),o.rotate(Math.PI/2),t(35,o.textAlign="center",o),t(35,o.fillStyle="rgba(96, 165, 250, 0.6)",o),t(35,o.font="9px sans-serif",o),o.fillText("Pitch (Hz)",0,0),o.restore()}function An(i,f){if(!o||!N)return;const{times:p,pitch:S}=N,y=M.colors;t(35,o.strokeStyle=y.pitch,o),t(35,o.lineWidth=y.pitchWidth,o),o.beginPath();let v=!1;for(let x=0;x<p.length;x++){const T=p[x],I=S[x];if(T<i||T>f)continue;if(I===null||I<=xe||I>Me){v=!1;continue}const W=gt(T,i,f),X=Re(I);v?o.lineTo(W,X):(o.moveTo(W,X),v=!0)}o.stroke(),t(35,o.fillStyle=y.pitch,o);for(let x=0;x<p.length;x++){const T=p[x],I=S[x];if(T<i||T>f||I===null||I<=xe||I>Me)continue;const W=gt(T,i,f),X=Re(I);o.beginPath(),o.arc(W,X,2,0,Math.PI*2),o.fill()}}function Dn(i,f){if(!o||!N)return;const{times:p,formants:S}=N,y=M.colors.formant,v=[y.f1,y.f2,y.f3,y.f4],x=[S.f1,S.f2,S.f3,S.f4];for(let T=0;T<4;T++){const I=x[T];t(35,o.fillStyle=v[T],o);for(let W=0;W<p.length;W++){const X=p[W],et=I[W];if(X<i||X>f||et===null||et>z)continue;const K=gt(X,i,f),Rt=Fe(et);o.beginPath(),o.arc(K,Rt,y.size,0,Math.PI*2),o.fill()}}}function Cn(i,f){if(!o||!N)return;const{times:p,intensity:S}=N;t(35,o.strokeStyle="#4ade80",o),t(35,o.lineWidth=2,o),o.beginPath();let y=!1;const v=30,x=90;for(let T=0;T<p.length;T++){const I=p[T],W=S[T];if(I<i||I>f)continue;if(W===null){y=!1;continue}const X=gt(I,i,f),et=(W-v)/(x-v),K=F-et*F*.8-F*.1;y?o.lineTo(X,K):(o.moveTo(X,K),y=!0)}o.stroke()}function Fn(i,f){if(!o||!N)return;const{times:p,harmonicity:S}=N;t(35,o.strokeStyle="#fbbf24",o),t(35,o.lineWidth=2,o),o.beginPath();let y=!1;const v=-10,x=40;for(let T=0;T<p.length;T++){const I=p[T],W=S[T];if(I<i||I>f)continue;if(W===null){y=!1;continue}const X=gt(I,i,f),et=(W-v)/(x-v),K=F-et*F*.8-F*.1;y?o.lineTo(X,K):(o.moveTo(X,K),y=!0)}o.stroke()}function Rn(i,f){if(!o||!N||!N.cog)return;const{times:p,cog:S}=N;t(35,o.fillStyle="#c084fc",o);for(let y=0;y<p.length;y++){const v=p[y],x=S[y];if(v<i||v>f||x===null||x>z)continue;const T=gt(v,i,f),I=Fe(x);o.beginPath(),o.arc(T,I,2.5,0,Math.PI*2),o.fill()}}function In(i,f){if(!o||!N||!N.spectralTilt)return;const{times:p,spectralTilt:S}=N;t(35,o.strokeStyle="#22d3ee",o),t(35,o.lineWidth=2,o),o.beginPath();let y=!1;const v=0,x=40;for(let T=0;T<p.length;T++){const I=p[T],W=S[T];if(I<i||I>f)continue;if(W===null){y=!1;continue}const X=gt(I,i,f),et=(W-v)/(x-v),K=F-et*F*.8-F*.1;y?o.lineTo(X,K):(o.moveTo(X,K),y=!0)}o.stroke()}function qn(i,f){if(!o||!N||!N.a1p0)return;const{times:p,a1p0:S}=N;t(35,o.strokeStyle="#fb7185",o),t(35,o.lineWidth=2,o),o.beginPath();let y=!1;const v=-20,x=20;for(let T=0;T<p.length;T++){const I=p[T],W=S[T];if(I<i||I>f)continue;if(W===null){y=!1;continue}const X=gt(I,i,f),et=(W-v)/(x-v),K=F-et*F*.8-F*.1;y?o.lineTo(X,K):(o.moveTo(X,K),y=!0)}o.stroke()}function zn(i,f){if(!o)return;const p=B;for(const S of p){if(S.time<i||S.time>f)continue;const y=gt(S.time,i,f),v=Fe(S.frequency),x=_===S.id;t(35,o.strokeStyle=x?"#ff6b6b":"#ffcc00",o),t(35,o.lineWidth=x?2:1,o),o.setLineDash([3,3]),o.beginPath(),o.moveTo(y,0),o.lineTo(y,F),o.stroke(),o.setLineDash([]),t(35,o.fillStyle=x?"#ff6b6b":"#ffcc00",o),o.beginPath(),o.arc(y,v,x?6:4,0,Math.PI*2),o.fill(),t(35,o.strokeStyle="#000",o),t(35,o.lineWidth=1,o),o.beginPath(),o.arc(y,v,x?6:4,0,Math.PI*2),o.stroke(),t(35,o.fillStyle="#ffcc00",o),t(35,o.font="10px sans-serif",o),t(35,o.textAlign="center",o),o.fillText(`P${S.id}`,y,12)}}function Fe(i){return F-i/z*F}function pe(i){return(1-i/F)*z}function Re(i){return F-(i-xe)/(Me-xe)*F}function gt(i,f,p){return ht+(i-f)/(p-f)*u}function re(i,f,p){return f+(i-ht)/u*(p-f)}function Bn(i){document.activeElement instanceof HTMLInputElement&&document.activeElement.blur();const f=V.getBoundingClientRect(),p=i.clientX-f.left,S=i.clientY-f.top;if(p<ht||p>G-St)return;const y=re(p,w.start,w.end),v=pe(S);if(Y){const x=we(y,v,.02,z*.05);if(x){Zt(),t(8,st=!0),vt=x.id,be.set(x.id);return}}it=!0,Z=y,Ct.set(y),Wt.set(null)}function En(i){const f=V.getBoundingClientRect(),p=i.clientX-f.left,S=i.clientY-f.top;if(p<ht||p>G-St){zt.set(null),st||ye.set(null);return}const y=re(p,w.start,w.end),v=pe(S);if(zt.set(y),st&&vt!==null){Ts(vt,y,v);return}if(Y){const x=we(y,v,.02,z*.05);ye.set((x==null?void 0:x.id)??null)}it&&(Math.abs(y-Z)>.001&&Wt.set({start:Math.min(Z,y),end:Math.max(Z,y)}),Ct.set(y))}function Wn(){st&&(t(8,st=!1),vt=null,be.set(null)),it=!1}function On(){st&&(t(8,st=!1),vt=null,be.set(null)),it=!1,zt.set(null),ye.set(null)}function Ln(i){if(!Y)return;const f=V.getBoundingClientRect(),p=i.clientX-f.left,S=i.clientY-f.top;if(p<ht||p>G-St)return;const y=re(p,w.start,w.end),v=pe(S);we(y,v,.02,z*.05)||Sn(y,v)}function Hn(i){if(!Y)return;const f=V.getBoundingClientRect(),p=i.clientX-f.left,S=i.clientY-f.top;if(p<ht||p>G-St)return;const y=re(p,w.start,w.end),v=pe(S),x=we(y,v,.02,z*.05);x&&(i.preventDefault(),t(9,Tt={x:i.clientX,y:i.clientY,pointId:x.id}))}function Ye(){t(9,Tt=null)}function Vn(){Tt&&(vs(Tt.pointId),t(9,Tt=null))}function Xn(i){i.preventDefault();const f=V.getBoundingClientRect(),p=i.clientX-f.left,S=re(p,w.start,w.end),y=b?b.length/m:10,{start:v,end:x}=w,T=x-v;if(Math.abs(i.deltaX)>Math.abs(i.deltaY)){const Rt=i.deltaX/u*T;let Pt=v+Rt,Qt=x+Rt;Pt<0&&(Pt=0,Qt=T),Qt>y&&(Qt=y,Pt=y-T),bt.set({start:Pt,end:Qt});return}const I=i.deltaY>0?1.1:.91,W=Math.max(.01,Math.min(y,T*I)),X=(S-v)/T,et=Math.max(0,S-X*W),K=Math.min(y,et+W);bt.set({start:Math.max(0,K-W),end:K})}function jn(){g&&(c?Ne():Xe(g.start,g.end))}function Gn(){const i=b?b.length/m:10,{start:f,end:p}=w,S=p-f,y=(f+p)/2,v=Math.max(.01,S*.7),x=Math.max(0,y-v/2),T=Math.min(i,x+v);bt.set({start:Math.max(0,T-v),end:T})}function Un(){const i=b?b.length/m:10,{start:f,end:p}=w,S=p-f,y=(f+p)/2,v=Math.min(i,S*1.4),x=Math.max(0,y-v/2),T=Math.min(i,x+v);bt.set({start:Math.max(0,T-v),end:T})}function Yn(){if(!g)return;const i=(g.end-g.start)*.1,f=b?b.length/m:10;bt.set({start:Math.max(0,g.start-i),end:Math.min(f,g.end+i)})}function Jn(){const i=b?b.length/m:10;bt.set({start:0,end:i})}function Zn(i){ie.call(this,e,i)}function Kn(i){ie.call(this,e,i)}function Qn(i){ie.call(this,e,i)}function $n(i){ie.call(this,e,i)}function ts(i){ie.call(this,e,i)}const es=i=>i.key==="Escape"&&Tt&&Ye();function ns(i){ne[i?"unshift":"push"](()=>{V=i,t(6,V)})}function ss(i){ne[i?"unshift":"push"](()=>{Q=i,t(5,Q)})}return e.$$set=i=>{"showPitch"in i&&t(26,C=i.showPitch),"showFormants"in i&&t(27,H=i.showFormants),"showIntensity"in i&&t(28,at=i.showIntensity),"showHNR"in i&&t(29,L=i.showHNR),"showCoG"in i&&t(30,Ft=i.showCoG),"showSpectralTilt"in i&&t(31,Nt=i.showSpectralTilt),"showA1P0"in i&&t(32,k=i.showA1P0),"showDataPoints"in i&&t(33,Y=i.showDataPoints),"maxFreq"in i&&t(34,z=i.maxFreq)},e.$$.update=()=>{e.$$.dirty[1]&8192&&t(42,s=w.end-w.start),e.$$.dirty[1]&1048576&&t(40,r=E>jt),e.$$.dirty[1]&2560&&t(2,l=r&&s>jt),e.$$.dirty[0]&1|e.$$.dirty[1]&266888&&b&&A&&!r&&(!rt||z!==Ht)&&Pn(),e.$$.dirty[0]&2080374814|e.$$.dirty[1]&778367&&t(41,a=[o,_t,ct,G,w,g,U,P,N,B,_,D,z,C,H,at,L,Ft,Nt,k,Y,l]),e.$$.dirty[0]&6|e.$$.dirty[1]&1136&&a&&o&&G>0&&(_t||l||ct)&&de(),e.$$.dirty[1]&32&&t(39,u=Math.max(0,G-ht-St)),e.$$.dirty[0]&1|e.$$.dirty[1]&275200&&w&&b&&A&&u>0&&(rt||r)&&Vt(w.start,w.end),e.$$.dirty[1]&32&&(d=G-St),e.$$.dirty[0]&8|e.$$.dirty[1]&8224&&t(10,h=g&&G>0?gt(Math.max(g.start,w.start),w.start,w.end):0)},[rt,ct,l,g,_,Q,V,Mt,st,Tt,h,c,Bn,En,Wn,On,Ln,Hn,Ye,Vn,Xn,jn,Gn,Un,Yn,Jn,C,H,at,L,Ft,Nt,k,Y,z,o,G,_t,Ht,u,r,a,s,b,w,B,N,U,P,A,D,E,Zn,Kn,Qn,$n,ts,es,ns,ss]}class ro extends Le{constructor(n){super(),He(this,n,As,Ns,Ee,{showPitch:26,showFormants:27,showIntensity:28,showHNR:29,showCoG:30,showSpectralTilt:31,showA1P0:32,showDataPoints:33,maxFreq:34},null,[-1,-1,-1])}}function Ds(e){let n,t;return{c(){n=dt("div"),t=dt("canvas"),this.h()},l(s){n=mt(s,"DIV",{class:!0});var r=pt(n);t=mt(r,"CANVAS",{class:!0}),pt(t).forEach(j),r.forEach(j),this.h()},h(){q(t,"class","svelte-1ubvkuo"),q(n,"class","time-axis svelte-1ubvkuo")},m(s,r){wt(s,n,r),ut(n,t),e[5](t),e[6](n)},p:Dt,i:Dt,o:Dt,d(s){s&&j(n),e[5](null),e[6](null)}}}let on=24;function Cs(e,n){if(n>=60){const t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s.toString().padStart(2,"0")}`}else return n>=1?e.toFixed(0)+"s":n>=.1?e.toFixed(1):n>=.01?e.toFixed(2):e.toFixed(3)}function Fs(e,n,t){let s;nt(e,bt,g=>t(4,s=g));let r,l,a=null,u=0,d;We(()=>{t(2,a=l.getContext("2d")),d=new ResizeObserver(g=>{const w=g[0].contentRect;t(3,u=w.width),t(1,l.width=u*devicePixelRatio,l),t(1,l.height=on*devicePixelRatio,l),a&&a.scale(devicePixelRatio,devicePixelRatio),h()}),d.observe(r)}),Oe(()=>{d==null||d.disconnect()});function h(){if(!a||u===0)return;const{start:g,end:w}=s,c=w-g;t(2,a.fillStyle="#2d2d2d",a),a.fillRect(0,0,u,on);const _=Math.floor(u/80),B=c/_;let M=[.001,.002,.005,.01,.02,.05,.1,.2,.5,1,2,5,10,30,60].find(A=>A>=B)||60;t(2,a.strokeStyle="#606060",a),t(2,a.fillStyle="#a0a0a0",a),t(2,a.font="10px sans-serif",a),t(2,a.textAlign="center",a);const U=Math.ceil(g/M)*M;for(let A=U;A<=w;A+=M){const D=(A-g)/c*u;a.beginPath(),a.moveTo(D,0),a.lineTo(D,6),a.stroke();const E=Cs(A,M);a.fillText(E,D,18)}const P=M/5;if(P>=.001){t(2,a.strokeStyle="#404040",a);const A=Math.ceil(g/P)*P;for(let D=A;D<=w;D+=P){const E=(D-g)/c*u;a.beginPath(),a.moveTo(E,0),a.lineTo(E,3),a.stroke()}}}function m(g){ne[g?"unshift":"push"](()=>{l=g,t(1,l)})}function b(g){ne[g?"unshift":"push"](()=>{r=g,t(0,r)})}return e.$$.update=()=>{e.$$.dirty&28&&a&&u>0&&s&&h()},[r,l,a,u,s,m,b]}class io extends Le{constructor(n){super(),He(this,n,Fs,Ds,Ee,{})}}export{Gs as A,Us as B,no as C,Ys as D,Js as E,Ms as F,Ks as G,Zs as H,ft as I,Xs as J,so as K,oo as L,qe as M,Kt as N,js as O,ro as S,io as T,Ws as W,Ot as a,Ct as b,Hs as c,an as d,Wt as e,Es as f,se as g,me as h,Os as i,ke as j,ot as k,Ne as l,Xe as m,Yt as n,Zt as o,Vs as p,$s as q,Ls as r,Lt as s,bt as t,zt as u,eo as v,fe as w,xs as x,Qs as y,to as z};
