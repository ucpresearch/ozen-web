import{s as Ee,n as At,d as G,r as he,i as Mt,b as ut,E as Q,B as q,c as dt,e as gt,h as pt,k as nt,w as We,G as Oe,D as ee,v as F,I as ge,_ as Pt,g as qt,H as te,x as Je,j as zt,C as $t,a1 as ie,N as le,O as ae,z as ns}from"./DzR6qLkJ.js";import{S as Le,i as He}from"./CbSE4UIZ.js";import{c as Ve,g as on}from"./BmAGY9Gp.js";import{w as $,d as rn}from"./azyml33n.js";import{b as ss}from"./D_kLiL9E.js";const Lt=$(null),Ht=$(44100),Bs=$(""),ln=$(0),wt=$({start:0,end:5}),Dt=$(0),Ot=$(null),Bt=$(null);rn(wt,e=>e.end-e.start);function os(e){let n,t,s,r;return{c(){n=pt("div"),t=pt("canvas"),this.h()},l(l){n=dt(l,"DIV",{class:!0,role:!0,"aria-label":!0});var a=gt(n);t=dt(a,"CANVAS",{class:!0}),gt(t).forEach(G),a.forEach(G),this.h()},h(){q(t,"class","svelte-vdkqpy"),q(n,"class","waveform-container svelte-vdkqpy"),q(n,"role","application"),q(n,"aria-label","Audio waveform - click and drag to select, scroll to zoom")},m(l,a){Mt(l,n,a),ut(n,t),e[14](t),e[15](n),s||(r=[Q(n,"mousedown",e[2]),Q(n,"mousemove",e[3]),Q(n,"mouseup",e[4]),Q(n,"mouseleave",e[5]),Q(n,"wheel",e[6])],s=!0)},p:At,i:At,o:At,d(l){l&&G(n),e[14](null),e[15](null),s=!1,he(r)}}}const bt=45,Qt=45;function rs(e,n,t){let s,r,l,a,u,d,h,m,x;nt(e,wt,k=>t(9,l=k)),nt(e,Ht,k=>t(22,a=k)),nt(e,Lt,k=>t(10,u=k)),nt(e,Dt,k=>t(11,d=k)),nt(e,Bt,k=>t(12,h=k)),nt(e,Ot,k=>t(13,m=k)),nt(e,Ve,k=>t(23,x=k));let g,b,c=null,_=0,B=0,N,M=!1,J=0;We(()=>{t(7,c=b.getContext("2d")),N=new ResizeObserver(k=>{const Z=k[0].contentRect;t(8,_=Z.width),B=Z.height,t(1,b.width=_*devicePixelRatio,b),t(1,b.height=B*devicePixelRatio,b),c&&c.scale(devicePixelRatio,devicePixelRatio),P()}),N.observe(g)}),Oe(()=>{N==null||N.disconnect()});function P(){if(!c||!u||_===0)return;const k=u,Z=a,{start:z,end:K}=l,X=x.colors;if(t(7,c.fillStyle=getComputedStyle(g).getPropertyValue("--color-bg").trim()||"#1a1a1a",c),c.fillRect(0,0,_,B),t(7,c.fillStyle=getComputedStyle(g).getPropertyValue("--color-surface").trim()||"#2a2a2a",c),c.fillRect(0,0,bt,B),c.fillRect(_-Qt,0,Qt,B),t(7,c.fillStyle=X.waveform.background,c),c.fillRect(bt,0,s,B),m){const O=Math.max(m.start,z),it=Math.min(m.end,K);if(it>O){const V=A(O,z,K),ct=A(it,z,K);t(7,c.fillStyle=X.selection.fill,c),c.fillRect(V,0,ct-V,B)}}const o=Math.floor(z*Z),U=Math.ceil(K*Z),C=(U-o)/s;let vt=0;const rt=U-o,se=Math.max(1,Math.floor(rt/1e3));for(let O=Math.max(0,o);O<Math.min(U,k.length);O+=se){const it=Math.abs(k[O]);it>vt&&(vt=it)}const St=vt>.01?Math.min(.95/vt,10):1;t(7,c.strokeStyle=X.waveform.line,c),t(7,c.lineWidth=X.waveform.lineWidth,c);const ot=B/2,tt=(B/2-4)*St;if(c.save(),c.beginPath(),c.rect(bt,0,s,B),c.clip(),C<=1){c.beginPath();for(let O=0;O<s;O++){const it=Math.floor(o+O*C);if(it>=0&&it<k.length){const V=bt+O,ct=ot-k[it]*tt;O===0?c.moveTo(V,ct):c.lineTo(V,ct)}}c.stroke()}else{const O=[],it=[];for(let V=0;V<s;V++){const ct=Math.floor(o+V*C),yt=Math.floor(o+(V+1)*C);let Ft=1/0,oe=-1/0;for(let Rt=ct;Rt<yt&&Rt<k.length;Rt++)if(Rt>=0){const Zt=k[Rt];Zt<Ft&&(Ft=Zt),Zt>oe&&(oe=Zt)}Ft!==1/0?(O.push(Ft),it.push(oe)):(O.push(0),it.push(0))}t(7,c.fillStyle=X.waveform.line,c),c.beginPath();for(let V=0;V<O.length;V++){const ct=bt+V,yt=ot-it[V]*tt;V===0?c.moveTo(ct,yt):c.lineTo(ct,yt)}for(let V=O.length-1;V>=0;V--){const ct=bt+V,yt=ot-O[V]*tt;c.lineTo(ct,yt)}c.closePath(),c.fill()}if(t(7,c.strokeStyle="rgba(128, 128, 128, 0.3)",c),t(7,c.lineWidth=1,c),c.beginPath(),c.moveTo(bt,ot),c.lineTo(r,ot),c.stroke(),h!==null){const O=A(h,z,K);O>=bt&&O<=r&&(t(7,c.strokeStyle=X.cursor,c),t(7,c.lineWidth=1,c),c.setLineDash([4,4]),c.beginPath(),c.moveTo(O,0),c.lineTo(O,B),c.stroke(),c.setLineDash([]))}const ht=A(d,z,K);ht>=bt&&ht<=r&&(t(7,c.strokeStyle=X.cursor,c),t(7,c.lineWidth=X.cursorWidth,c),c.beginPath(),c.moveTo(ht,0),c.lineTo(ht,B),c.stroke()),c.restore()}function A(k,Z,z){return bt+(k-Z)/(z-Z)*s}function D(k,Z,z){return Z+(k-bt)/s*(z-Z)}function E(k){document.activeElement instanceof HTMLInputElement&&document.activeElement.blur();const Z=b.getBoundingClientRect(),z=k.clientX-Z.left;if(z<bt||z>_-Qt)return;const K=D(z,l.start,l.end);k.shiftKey||(M=!0,J=K,Dt.set(K),Ot.set(null))}function R(k){const Z=b.getBoundingClientRect(),z=k.clientX-Z.left;if(z<bt||z>_-Qt){Bt.set(null);return}const K=D(z,l.start,l.end);Bt.set(K),M&&(Math.abs(K-J)>.001&&Ot.set({start:Math.min(J,K),end:Math.max(J,K)}),Dt.set(K))}function H(){M=!1}function at(){M=!1,Bt.set(null)}function L(k){k.preventDefault();const Z=b.getBoundingClientRect(),z=k.clientX-Z.left,K=D(z,l.start,l.end),X=u?u.length/a:10,{start:o,end:U}=l,C=U-o;if(Math.abs(k.deltaX)>Math.abs(k.deltaY)){const tt=k.deltaX/s*C;let ht=o+tt,O=U+tt;ht<0&&(ht=0,O=C),O>X&&(O=X,ht=X-C),wt.set({start:ht,end:O});return}const vt=k.deltaY>0?1.1:.91,rt=Math.max(.01,Math.min(X,C*vt)),se=(K-o)/C,St=Math.max(0,K-se*rt),ot=Math.min(X,St+rt);wt.set({start:Math.max(0,ot-rt),end:ot})}function Ct(k){ee[k?"unshift":"push"](()=>{b=k,t(1,b)})}function kt(k){ee[k?"unshift":"push"](()=>{g=k,t(0,g)})}return e.$$.update=()=>{e.$$.dirty&256&&(s=Math.max(0,_-bt-Qt)),e.$$.dirty&256&&(r=_-Qt),e.$$.dirty&16256&&c&&u&&_>0&&l&&m!==void 0&&d!==void 0&&h!==void 0&&P()},[g,b,E,R,H,at,L,c,_,l,u,d,h,m,Ct,kt]}class Es extends Le{constructor(n){super(),He(this,n,rs,os,Ee,{})}}const fe=$(!1),qe=$(null);let ce=null;const is={"praatfan-gpl":"https://ucpresearch.github.io/praatfan-core-rs/pkg/praatfan_gpl.js",praatfan:"https://ucpresearch.github.io/praatfan-core-clean/pkg/praatfan.js"};function ls(e){return e==="praatfan-local"?`${ss}/wasm/praatfan/praatfan.js`:is[e]}const as={"praatfan-gpl":"praatfan-gpl",praatfan:"praatfan","praatfan-local":"praatfan"};async function Ws(e="praatfan-local"){if(!(F(qe)===e&&ce)){fe.set(!1),ce=null;try{const t=ls(e);console.log(`Loading WASM module from ${t}...`);const s=await import(t);await s.default(),(e==="praatfan"||e==="praatfan-local")&&typeof s.init=="function"&&s.init(),ce=s,qe.set(e),fe.set(!0),console.log(`WASM acoustic analysis module initialized (${e})`)}catch(t){throw console.error("Failed to initialize WASM module:",t),t}}}function Se(){if(!ce)throw new Error("WASM module not initialized. Call initWasm() first.");return ce}function cs(){const e=F(qe);if(!e)throw new Error("No backend loaded. Call initWasm() first.");return e}function Ut(){const e=cs();return as[e]}function an(e,n,t,s){return Ut()==="praatfan-gpl"?e.to_pitch(n,t,s):e.to_pitch_ac(n,t,s)}function cn(e,n,t){return e.to_intensity(n,t)}function un(e,n,t,s,r,l){return e.to_formant_burg(n,t,s,r,l)}function fn(e,n,t,s,r){return e.to_harmonicity_ac(n,t,s,r)}function _e(e,n,t,s,r){return Ut()==="praatfan-gpl"?e.to_spectrogram(n,t,s,r,"gaussian"):e.to_spectrogram(n,t,s,r)}function us(e,n){return e.to_spectrum(n)}function hn(e){return e.times()}function mn(e){return e.values()}function dn(e,n){if(Ut()==="praatfan-gpl")return e.get_value_at_time(n,"cubic");{const s=e.times(),r=e.values();return Ce(s,r,n)}}function Et(e,n,t){if(Ut()==="praatfan-gpl")return e.get_value_at_time(n,t,"hertz","linear");{const r=e.times(),l=e.formant_values(n);return Ce(r,l,t)}}function Wt(e,n,t){if(Ut()==="praatfan-gpl")return e.get_bandwidth_at_time(n,t,"hertz","linear");{const r=e.times(),l=e.bandwidth_values(n);return Ce(r,l,t)}}function pn(e,n){if(Ut()==="praatfan-gpl")return e.get_value_at_time(n,"linear");{const s=e.times(),r=e.values();return Ce(s,r,n)}}function Pe(e){return Ut()==="praatfan-gpl"?{values:e.values(),freqMin:e.freq_min,freqMax:e.freq_max,timeMin:e.start_time,timeMax:e.start_time+(e.num_frames-1)*e.time_step,nFreqs:e.num_freq_bins,nTimes:e.num_frames}:{values:e.values(),freqMin:e.freq_min(),freqMax:e.freq_max(),timeMin:e.time_min(),timeMax:e.time_max(),nFreqs:e.n_freqs(),nTimes:e.n_times()}}function Ce(e,n,t){if(e.length===0)return NaN;if(e.length===1)return n[0];const s=e.length>1?e[1]-e[0]:1,r=e[0],l=(t-r)/s;if(l<=0)return n[0];if(l>=e.length-1)return n[e.length-1];const a=Math.floor(l),u=a+1,d=l-a,h=n[a],m=n[u];return isNaN(h)&&isNaN(m)?NaN:isNaN(h)?m:isNaN(m)?h:h+d*(m-h)}const ke=$(!1),st=$(0),ne=$(null),gn=$({timeStep:.01,pitchFloor:75,pitchCeiling:600,maxFormant:5500,numFormants:5}),Vt=60;async function Os(){const e=F(Lt),n=F(Ht),t=F(fe);if(!e||!t){console.warn("Cannot run analysis: audio or WASM not ready");return}const s=F(ln);if(s>Vt){console.log(`Audio duration ${s.toFixed(1)}s exceeds ${Vt}s limit, skipping analysis`),ne.set(null);return}ke.set(!0),st.set(0);try{const r=F(gn),l=on(),a=Se(),u=new a.Sound(e,n);try{st.set(10);const d=an(u,r.timeStep,r.pitchFloor,r.pitchCeiling);st.set(25);const h=cn(u,r.pitchFloor,r.timeStep);st.set(40);const m=un(u,r.timeStep,r.numFormants,l.maxFormant,.025,50);st.set(55);const x=fn(u,r.timeStep,r.pitchFloor,.1,4.5);st.set(70);const g=Array.from(hn(d)),b=Array.from(mn(d));st.set(75);const c=_e(u,.005,5e3,.002,20);st.set(85);const _=yn(e,n,g,b,a),B=Pe(c);st.set(95);const N={times:g,pitch:b.map(M=>isNaN(M)||M===0?null:M),intensity:g.map(M=>{const J=dn(h,M);return isNaN(J)?null:J}),formants:{f1:g.map(M=>lt(Et(m,1,M))),f2:g.map(M=>lt(Et(m,2,M))),f3:g.map(M=>lt(Et(m,3,M))),f4:g.map(M=>lt(Et(m,4,M))),b1:g.map(M=>lt(Wt(m,1,M))),b2:g.map(M=>lt(Wt(m,2,M))),b3:g.map(M=>lt(Wt(m,3,M))),b4:g.map(M=>lt(Wt(m,4,M)))},harmonicity:g.map(M=>lt(pn(x,M))),cog:_.cog,spectralTilt:_.spectralTilt,a1p0:_.a1p0,spectrogram:B};d.free(),h.free(),m.free(),x.free(),c.free(),st.set(100),ne.set(N)}finally{u.free()}}catch(r){throw console.error("Analysis failed:",r),r}finally{ke.set(!1)}}function lt(e){return isNaN(e)||e===0?null:e}async function fs(e,n){const t=F(Lt),s=F(Ht),r=F(fe);if(!t||!r){console.warn("Cannot run analysis: audio or WASM not ready");return}const l=n-e;if(l>Vt){console.log(`Range ${l.toFixed(1)}s exceeds ${Vt}s limit`);return}ke.set(!0),st.set(0);try{const a=F(gn),u=on(),d=Se(),h=.1,m=Math.max(0,e-h),x=Math.min(t.length/s,n+h),g=Math.floor(m*s),b=Math.ceil(x*s),c=t.slice(g,b),_=new d.Sound(c,s);try{st.set(15);const B=an(_,a.timeStep,a.pitchFloor,a.pitchCeiling);st.set(30);const N=cn(_,a.pitchFloor,a.timeStep);st.set(45);const M=un(_,a.timeStep,a.numFormants,u.maxFormant,.025,50);st.set(60);const J=fn(_,a.timeStep,a.pitchFloor,.1,4.5);st.set(75);const P=Array.from(hn(B)),A=P.map(L=>L+m),D=Array.from(mn(B));st.set(85);const E=_e(_,.005,5e3,.002,20),R=yn(c,s,P,D,d),H=Pe(E);H.timeMin=m,H.timeMax=x,st.set(95);const at={times:A,pitch:D.map(L=>isNaN(L)||L===0?null:L),intensity:A.map((L,Ct)=>{const kt=dn(N,P[Ct]);return isNaN(kt)?null:kt}),formants:{f1:P.map(L=>lt(Et(M,1,L))),f2:P.map(L=>lt(Et(M,2,L))),f3:P.map(L=>lt(Et(M,3,L))),f4:P.map(L=>lt(Et(M,4,L))),b1:P.map(L=>lt(Wt(M,1,L))),b2:P.map(L=>lt(Wt(M,2,L))),b3:P.map(L=>lt(Wt(M,3,L))),b4:P.map(L=>lt(Wt(M,4,L)))},harmonicity:P.map(L=>lt(pn(J,L))),cog:R.cog,spectralTilt:R.spectralTilt,a1p0:R.a1p0,spectrogram:H};B.free(),N.free(),M.free(),J.free(),E.free(),st.set(100),ne.set(at),console.log(`Analysis completed for range ${e.toFixed(1)}s - ${n.toFixed(1)}s`)}finally{_.free()}}catch(a){throw console.error("Range analysis failed:",a),a}finally{ke.set(!1)}}function yn(e,n,t,s,r){const u=Math.floor(.025*n),d=[],h=[],m=[];for(let x=0;x<t.length;x++){const g=t[x],b=s[x],c=Math.max(0,Math.floor((g-.0125)*n)),_=Math.min(e.length,c+u);if(_-c<u/2){d.push(null),h.push(null),m.push(null);continue}try{const B=e.slice(c,_),N=new r.Sound(B,n),M=us(N,!0),J=M.get_center_of_gravity(2);d.push(isNaN(J)||J<=0?null:J);const P=M.get_band_energy(0,500),A=M.get_band_energy(2e3,4e3);if(P>0&&A>0){const D=10*Math.log10(P)-10*Math.log10(A);h.push(isNaN(D)?null:D)}else h.push(null);if(b&&!isNaN(b)&&b>0){const D=M.get_band_energy(b*.9,b*1.1),E=M.get_band_energy(200,300);if(D>0&&E>0){const R=10*Math.log10(D)-10*Math.log10(E);m.push(isNaN(R)?null:R)}else m.push(null)}else m.push(null);M.free(),N.free()}catch{d.push(null),h.push(null),m.push(null)}}return{cog:d,spectralTilt:h,a1p0:m}}function Ls(){ne.set(null),st.set(0)}const me=$(!1),ze=$("full");let ue=null,Nt=null,xn=0,ve=0,Be=0,Te=null;function hs(){return ue||(ue=new AudioContext),ue}function ms(){const e=F(Lt),n=F(Ht);if(!e)return;e.length/n;const t=F(Dt),s=F(Ot),r=F(wt);let l,a;s&&s.end>s.start?(l=s.start,a=s.end,ze.set("selection")):(l=t,a=r.end,ze.set("visible")),Xe(l,a)}function Xe(e,n){Ne();const t=F(Lt),s=F(Ht);if(!t)return;const r=hs(),a=Math.ceil(.3*s),u=t.length+a,d=r.createBuffer(1,u,s),h=d.getChannelData(0);for(let m=0;m<t.length;m++)h[m]=t[m];Nt=r.createBufferSource(),Nt.buffer=d,Nt.connect(r.destination),ve=Math.max(0,e),Be=Math.min(t.length/s,n),xn=r.currentTime,Nt.start(0,ve,Be-ve),me.set(!0),Nt.onended=()=>{Ne()},wn()}function Hs(){const e=F(wt);ze.set("visible"),Xe(e.start,e.end)}function bn(){Nt&&(Nt.stop(),Nt.disconnect(),Nt=null),Te!==null&&(cancelAnimationFrame(Te),Te=null),me.set(!1)}function Ne(){bn();const e=F(Ot);e&&Dt.set(e.start)}function Vs(){F(me)?bn():ms()}function wn(){if(!F(me)||!ue)return;const e=ue.currentTime-xn,n=ve+e;if(n>=Be){Ne();return}Dt.set(n),Te=requestAnimationFrame(wn)}function ds(e){const n=e.split(/\r?\n/);let t=0;function s(){for(;t<n.length&&n[t].trim()==="";)t++;return t<n.length?n[t++].trim():""}const r=s(),l=r==='"ooTextFile"'||!r.includes("=");return t=0,l?ps(n):gs(n)}function ps(e){let n=0;const t=[];function s(){for(;n<e.length&&e[n].trim()==="";)n++;return n<e.length?e[n++].trim():""}function r(){return s().replace(/^"|"$/g,"")}function l(){return parseFloat(s())}r(),r();const a=l(),u=l();s();const d=l();for(let h=0;h<d;h++){const m=r(),x=r();l(),l();const g=l(),b={name:x,type:m==="IntervalTier"?"interval":"point",intervals:[]};for(let c=0;c<g;c++)if(b.type==="interval"){const _=l(),B=l(),N=r();b.intervals.push({start:_,end:B,text:N})}else{const _=l(),B=r();b.intervals.push({start:_,end:_,text:B})}t.push(b)}return{tiers:t,xmin:a,xmax:u}}function gs(e){let n=0;const t=[];function s(){for(;n<e.length&&e[n].trim()==="";)n++;return n<e.length?e[n++].trim():""}function r(h){const m=h.match(/=\s*(.+)$/);return m?m[1].trim():h.trim()}function l(h){return parseFloat(r(h))}function a(h){return r(h).replace(/^"|"$/g,"")}s(),s();let u=0,d=0;for(;n<e.length;){const h=s();if(h.startsWith("xmin"))u=l(h);else if(h.startsWith("xmax"))d=l(h);else if(h.includes("size =")){const m=l(h);s();for(let x=0;x<m;x++){s();const g=s(),b=a(g),c=s(),_=a(c),B=s();l(B);const N=s();l(N);const M=s(),J=l(M),P={name:_,type:b==="IntervalTier"?"interval":"point",intervals:[]};for(let A=0;A<J;A++)if(s(),P.type==="interval"){const D=l(s()),E=l(s()),R=a(s());P.intervals.push({start:D,end:E,text:R})}else{const D=l(s()),E=a(s());P.intervals.push({start:D,end:D,text:E})}t.push(P)}break}}return{tiers:t,xmin:u,xmax:d}}function ys(e,n,t){const s=[];s.push('File type = "ooTextFile"'),s.push('Object class = "TextGrid"'),s.push(""),s.push(`xmin = ${n}`),s.push(`xmax = ${t}`),s.push("tiers? <exists>"),s.push(`size = ${e.length}`),s.push("item []:");for(let r=0;r<e.length;r++){const l=e[r];s.push(`    item [${r+1}]:`),s.push(`        class = "${l.type==="interval"?"IntervalTier":"TextTier"}"`),s.push(`        name = "${Ie(l.name)}"`);const a=l.intervals.length>0?l.intervals[0].start:n,u=l.intervals.length>0?l.intervals[l.intervals.length-1].end:t;if(s.push(`        xmin = ${a}`),s.push(`        xmax = ${u}`),l.type==="interval"){s.push(`        intervals: size = ${l.intervals.length}`);for(let d=0;d<l.intervals.length;d++){const h=l.intervals[d];s.push(`        intervals [${d+1}]:`),s.push(`            xmin = ${h.start}`),s.push(`            xmax = ${h.end}`),s.push(`            text = "${Ie(h.text)}"`)}}else{s.push(`        points: size = ${l.intervals.length}`);for(let d=0;d<l.intervals.length;d++){const h=l.intervals[d];s.push(`        points [${d+1}]:`),s.push(`            number = ${h.start}`),s.push(`            mark = "${Ie(h.text)}"`)}}}return s.join(`
`)}function Ie(e){return e.replace(/"/g,'""')}const xs=50,Ae=$([]),De=$([]);let Xt=null,jt=null;function je(){if(!Xt)return[];let e=[];return Xt.subscribe(t=>{e=t})(),e}function Ge(){if(!jt)return[];let e=[];return jt.subscribe(t=>{e=t})(),e}function Xs(e,n){Xt=e,jt=n}function Yt(){const e={tiers:JSON.parse(JSON.stringify(je())),dataPoints:JSON.parse(JSON.stringify(Ge()))};Ae.update(n=>{const t=[...n,e];return t.length>xs&&t.shift(),t}),De.set([])}function js(){const e=F(Ae);if(e.length===0)return!1;const n={tiers:JSON.parse(JSON.stringify(je())),dataPoints:JSON.parse(JSON.stringify(Ge()))};De.update(s=>[...s,n]);const t=e[e.length-1];return Ae.update(s=>s.slice(0,-1)),Xt&&Xt.set(t.tiers),jt&&jt.set(t.dataPoints),!0}function Gs(){const e=F(De);if(e.length===0)return!1;const n={tiers:JSON.parse(JSON.stringify(je())),dataPoints:JSON.parse(JSON.stringify(Ge()))};Ae.update(s=>[...s,n]);const t=e[e.length-1];return De.update(s=>s.slice(0,-1)),Xt&&Xt.set(t.tiers),jt&&jt.set(t.dataPoints),!0}const ft=$([]),Gt=$(0);rn([ft,Gt],([e,n])=>e[n]||null);const bs=$(null);function Us(e){try{const{tiers:n}=ds(e);Yt(),ft.set(n),Gt.set(0),bs.set(null)}catch(n){throw console.error("Failed to parse TextGrid:",n),n}}function Ys(){const e=F(Lt),n=F(Ht),t=e?e.length/n:1;return ys(F(ft),0,t)}function ws(e,n="interval"){const t=F(Lt),s=F(Ht),r=t?t.length/s:1,l={name:e,type:n,intervals:n==="interval"?[{start:0,end:r,text:""}]:[]};ft.update(a=>[...a,l])}function Js(e){ft.update(t=>t.filter((s,r)=>r!==e));const n=F(Gt);n>=e&&n>0&&Gt.update(t=>t-1)}function Zs(e,n){ft.update(t=>t.map((s,r)=>r===e?{...s,name:n}:s))}const Ze=.05;function Mn(e,n,t){for(let s=0;s<n;s++){const r=t[s];if(r.type==="interval")for(const l of r.intervals){if(Math.abs(l.start-e)<=Ze)return l.start;if(Math.abs(l.end-e)<=Ze)return l.end}}return null}function Ks(e){const n=F(Gt),t=F(ft);if(n<0||n>=t.length)return;const s=t[n];if(s.type!=="interval")return;const r=Mn(e,n,t),l=r!==null?r:e,a=s.intervals.findIndex(m=>l>m.start&&l<m.end);if(a===-1)return;Yt();const u=s.intervals[a],d={start:u.start,end:l,text:u.text},h={start:l,end:u.end,text:""};ft.update(m=>{const x=[...m];return x[n]={...x[n],intervals:[...x[n].intervals.slice(0,a),d,h,...x[n].intervals.slice(a+1)]},x})}function Qs(e){const n=F(Gt),t=F(ft);n<0||n>=t.length||e<=0||t[n].type!=="interval"||(Yt(),ft.update(r=>{const l=[...r],a=[...l[n].intervals],u=a[e-1],d=a[e],h={start:u.start,end:d.end,text:u.text||d.text};return a.splice(e-1,2,h),l[n]={...l[n],intervals:a},l}))}function $s(e,n,t){const s=F(ft);if(e<s.length&&n<s[e].intervals.length){if(s[e].intervals[n].text===t)return;Yt()}ft.update(r=>{const l=[...r];return e<l.length&&n<l[e].intervals.length&&(l[e]={...l[e],intervals:l[e].intervals.map((a,u)=>u===n?{...a,text:t}:a)}),l})}function to(e,n){const t=F(Gt),s=F(ft);if(t<0||t>=s.length||e<=0)return;const r=s[t],l=r.intervals[e-1],a=r.intervals[e],u=Mn(n,t,s),d=u!==null?u:n;d<=l.start||d>=a.end||ft.update(h=>{const m=[...h],x=[...m[t].intervals];return x[e-1]={...x[e-1],end:d},x[e]={...x[e],start:d},m[t]={...m[t],intervals:x},m})}function eo(){if(F(ft).length===0){const n=F(Ve);for(const t of n.annotation.defaultTiers)ws(t)}}const Jt=$([]),ye=$(null),xe=$(null);let vn=1;function Tn(e,n){Yt();const t=Sn(e),s=Ue(e),r={id:vn++,time:e,frequency:n,acousticValues:t,annotationIntervals:s};return Jt.update(l=>[...l,r]),r}function Ms(e){Yt();let n=null;return Jt.update(t=>{const s=t.findIndex(r=>r.id===e);return s!==-1?(n=t[s],[...t.slice(0,s),...t.slice(s+1)]):t}),n}function vs(e,n,t){let s=!1;return Jt.update(r=>r.map(l=>{if(l.id===e){s=!0;const a=Sn(n),u=Ue(n);return{...l,time:n,frequency:t,acousticValues:a,annotationIntervals:u}}return l})),s}function be(e,n,t=.02,s=100){const r=F(Jt);let l=null,a=1/0;for(const u of r){const d=Math.abs(u.time-e),h=Math.abs(u.frequency-n);if(d<=t&&h<=s){const m=(d/t)**2+(h/s)**2;m<a&&(a=m,l=u)}}return l}function Ts(){Jt.set([]),vn=1}function Sn(e){const n=F(ne);if(!n)return{};const{times:t}=n;let s=0,r=1/0;for(let l=0;l<t.length;l++){const a=Math.abs(t[l]-e);a<r&&(r=a,s=l)}return{Pitch:n.pitch[s],Intensity:n.intensity[s],F1:n.formants.f1[s],F2:n.formants.f2[s],F3:n.formants.f3[s],F4:n.formants.f4[s],B1:n.formants.b1[s],B2:n.formants.b2[s],B3:n.formants.b3[s],B4:n.formants.b4[s],HNR:n.harmonicity[s],CoG:n.cog[s],SpectralTilt:n.spectralTilt[s],"A1-P0":n.a1p0[s]}}function Ue(e){const n=F(ft),t={};for(const s of n)for(const r of s.intervals)if(e>=r.start&&e<r.end){t[s.name]=r.text;break}return t}function Ss(e,n){if(!n)return e;const t=[];for(const s of e){const r=s.toLowerCase();r==="pitch"||r==="f0"?n.showPitch&&t.push(s):r.startsWith("f")&&/^f[1-4]$/.test(r)||r.startsWith("b")&&/^b[1-4]$/.test(r)?n.showFormants&&t.push(s):r==="intensity"?n.showIntensity&&t.push(s):r==="hnr"||r==="harmonicity"?n.showHNR&&t.push(s):r==="cog"||r==="centerofgravity"?n.showCoG&&t.push(s):r==="spectraltilt"||r==="tilt"?n.showSpectralTilt&&t.push(s):r==="a1p0"||r==="a1-p0"?n.showA1P0&&t.push(s):t.push(s)}return t}function no(e){const n=F(Jt),t=F(ft);if(n.length===0)return`time	frequency
`;const s=new Set;for(const x of n)Object.keys(x.acousticValues).forEach(g=>s.add(g));const r=Array.from(s).sort(),l=Ss(r,e),a=t.map(x=>x.name),u=["time","frequency",...l,...a],h=[...n].sort((x,g)=>x.time-g.time).map(x=>{const g=[x.time.toFixed(4),x.frequency.toFixed(1)];for(const c of l){const _=x.acousticValues[c];g.push(_!=null?_.toFixed(2):"")}const b=Ue(x.time);for(const c of a)g.push(b[c]||"");return g});return[u.join("	"),...h.map(x=>x.join("	"))].join(`
`)}function so(e){const n=e.trim().split(`
`);if(n.length<2)return-1;const t=n[0].split("	").map(a=>a.trim().toLowerCase()),s=t.indexOf("time"),r=t.indexOf("frequency");if(s===-1||r===-1)return-1;Ts();let l=0;for(let a=1;a<n.length;a++){const u=n[a].trim();if(!u)continue;const d=u.split("	"),h=parseFloat(d[s]),m=parseFloat(d[r]);!isNaN(h)&&!isNaN(m)&&(Tn(h,m),l++)}return l}function Ke(e){let n,t="Computing spectrogram...";return{c(){n=pt("div"),n.textContent=t,this.h()},l(s){n=dt(s,"DIV",{class:!0,"data-svelte-h":!0}),te(n)!=="svelte-vvjva"&&(n.textContent=t),this.h()},h(){q(n,"class","computing svelte-1r84lea")},m(s,r){Mt(s,n,r)},d(s){s&&G(n)}}}function Qe(e){let n,t,s;function r(u,d){return u[8]?Ps:_s}let l=r(e),a=l(e);return{c(){n=pt("button"),a.c(),this.h()},l(u){n=dt(u,"BUTTON",{class:!0,style:!0,title:!0});var d=gt(n);a.l(d),d.forEach(G),this.h()},h(){q(n,"class","play-selection-btn svelte-1r84lea"),$t(n,"left",e[7]+4+"px"),q(n,"title","Play selection")},m(u,d){Mt(u,n,d),a.m(n,null),t||(s=[Q(n,"mousedown",Pt(e[55])),Q(n,"click",Pt(e[18]))],t=!0)},p(u,d){l!==(l=r(u))&&(a.d(1),a=l(u),a&&(a.c(),a.m(n,null))),d[0]&128&&$t(n,"left",u[7]+4+"px")},d(u){u&&G(n),a.d(),t=!1,he(s)}}}function _s(e){let n,t;return{c(){n=ae("svg"),t=ae("path"),this.h()},l(s){n=le(s,"svg",{viewBox:!0,fill:!0,width:!0,height:!0});var r=gt(n);t=le(r,"path",{d:!0}),gt(t).forEach(G),r.forEach(G),this.h()},h(){q(t,"d","M8 5v14l11-7z"),q(n,"viewBox","0 0 24 24"),q(n,"fill","currentColor"),q(n,"width","14"),q(n,"height","14")},m(s,r){Mt(s,n,r),ut(n,t)},d(s){s&&G(n)}}}function Ps(e){let n,t,s;return{c(){n=ae("svg"),t=ae("rect"),s=ae("rect"),this.h()},l(r){n=le(r,"svg",{viewBox:!0,fill:!0,width:!0,height:!0});var l=gt(n);t=le(l,"rect",{x:!0,y:!0,width:!0,height:!0}),gt(t).forEach(G),s=le(l,"rect",{x:!0,y:!0,width:!0,height:!0}),gt(s).forEach(G),l.forEach(G),this.h()},h(){q(t,"x","6"),q(t,"y","4"),q(t,"width","4"),q(t,"height","16"),q(s,"x","14"),q(s,"y","4"),q(s,"width","4"),q(s,"height","16"),q(n,"viewBox","0 0 24 24"),q(n,"fill","currentColor"),q(n,"width","14"),q(n,"height","14")},m(r,l){Mt(r,n,l),ut(n,t),ut(n,s)},d(r){r&&G(n)}}}function $e(e){let n,t='<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"></path></svg>',s,r;return{c(){n=pt("button"),n.innerHTML=t,this.h()},l(l){n=dt(l,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),te(n)!=="svelte-9j0vt3"&&(n.innerHTML=t),this.h()},h(){q(n,"class","zoom-btn svelte-1r84lea"),q(n,"title","Zoom to selection")},m(l,a){Mt(l,n,a),s||(r=[Q(n,"mousedown",Pt(e[52])),Q(n,"click",Pt(e[21]))],s=!0)},p:At,d(l){l&&G(n),s=!1,he(r)}}}function tn(e){let n,t,s,r,l="Remove data point",a,u;return{c(){n=pt("div"),t=zt(),s=pt("div"),r=pt("button"),r.textContent=l,this.h()},l(d){n=dt(d,"DIV",{class:!0}),gt(n).forEach(G),t=qt(d),s=dt(d,"DIV",{class:!0,style:!0});var h=gt(s);r=dt(h,"BUTTON",{class:!0,"data-svelte-h":!0}),te(r)!=="svelte-8fgbhx"&&(r.textContent=l),h.forEach(G),this.h()},h(){q(n,"class","context-menu-backdrop svelte-1r84lea"),q(r,"class","context-menu-item svelte-1r84lea"),q(s,"class","context-menu svelte-1r84lea"),$t(s,"left",e[6].x+"px"),$t(s,"top",e[6].y+"px")},m(d,h){Mt(d,n,h),Mt(d,t,h),Mt(d,s,h),ut(s,r),a||(u=[Q(n,"click",e[15]),Q(r,"click",e[16])],a=!0)},p(d,h){h[0]&64&&$t(s,"left",d[6].x+"px"),h[0]&64&&$t(s,"top",d[6].y+"px")},d(d){d&&(G(n),G(t),G(s)),a=!1,he(u)}}}function ks(e){let n,t,s,r,l,a,u,d='<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></svg>',h,m,x='<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M19 13H5v-2h14v2z"></path></svg>',g,b,c,_='<svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M4 4h6v6H4zm10 0h6v6h-6zM4 14h6v6H4zm10 0h6v6h-6z"></path></svg>',B,N,M,J,P=!e[0]&&Ke(),A=e[1]&&e[0]&&Qe(e),D=e[1]&&$e(e),E=e[6]&&tn(e);return{c(){n=pt("div"),P&&P.c(),t=zt(),s=pt("canvas"),r=zt(),A&&A.c(),l=zt(),a=pt("div"),u=pt("button"),u.innerHTML=d,h=zt(),m=pt("button"),m.innerHTML=x,g=zt(),D&&D.c(),b=zt(),c=pt("button"),c.innerHTML=_,B=zt(),E&&E.c(),N=Je(),this.h()},l(R){n=dt(R,"DIV",{class:!0,role:!0,"aria-label":!0});var H=gt(n);P&&P.l(H),t=qt(H),s=dt(H,"CANVAS",{class:!0}),gt(s).forEach(G),r=qt(H),A&&A.l(H),l=qt(H),a=dt(H,"DIV",{class:!0});var at=gt(a);u=dt(at,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),te(u)!=="svelte-r6msr3"&&(u.innerHTML=d),h=qt(at),m=dt(at,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),te(m)!=="svelte-q25joc"&&(m.innerHTML=x),g=qt(at),D&&D.l(at),b=qt(at),c=dt(at,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),te(c)!=="svelte-dflweb"&&(c.innerHTML=_),at.forEach(G),H.forEach(G),B=qt(R),E&&E.l(R),N=Je(),this.h()},h(){q(s,"class","svelte-1r84lea"),q(u,"class","zoom-btn svelte-1r84lea"),q(u,"title","Zoom in"),q(m,"class","zoom-btn svelte-1r84lea"),q(m,"title","Zoom out"),q(c,"class","zoom-btn svelte-1r84lea"),q(c,"title","Zoom to fit"),q(a,"class","zoom-controls svelte-1r84lea"),q(n,"class","spectrogram-container svelte-1r84lea"),q(n,"role","application"),q(n,"aria-label","Spectrogram - click and drag to select, scroll to zoom, double-click to add data point"),ge(n,"grabbing",e[5]),ge(n,"can-grab",e[2]!==null&&!e[5])},m(R,H){Mt(R,n,H),P&&P.m(n,null),ut(n,t),ut(n,s),e[57](s),ut(n,r),A&&A.m(n,null),ut(n,l),ut(n,a),ut(a,u),ut(a,h),ut(a,m),ut(a,g),D&&D.m(a,null),ut(a,b),ut(a,c),e[58](n),Mt(R,B,H),E&&E.m(R,H),Mt(R,N,H),M||(J=[Q(window,"keydown",e[56]),Q(u,"mousedown",Pt(e[54])),Q(u,"click",Pt(e[19])),Q(m,"mousedown",Pt(e[53])),Q(m,"click",Pt(e[20])),Q(c,"mousedown",Pt(e[51])),Q(c,"click",Pt(e[22])),Q(n,"mousedown",e[9]),Q(n,"mousemove",e[10]),Q(n,"mouseup",e[11]),Q(n,"mouseleave",e[12]),Q(n,"dblclick",e[13]),Q(n,"contextmenu",e[14]),Q(n,"wheel",e[17])],M=!0)},p(R,H){R[0]?P&&(P.d(1),P=null):P||(P=Ke(),P.c(),P.m(n,t)),R[1]&&R[0]?A?A.p(R,H):(A=Qe(R),A.c(),A.m(n,l)):A&&(A.d(1),A=null),R[1]?D?D.p(R,H):(D=$e(R),D.c(),D.m(a,b)):D&&(D.d(1),D=null),H[0]&32&&ge(n,"grabbing",R[5]),H[0]&36&&ge(n,"can-grab",R[2]!==null&&!R[5]),R[6]?E?E.p(R,H):(E=tn(R),E.c(),E.m(N.parentNode,N)):E&&(E.d(1),E=null)},i:At,o:At,d(R){R&&(G(n),G(B),G(N)),P&&P.d(),e[57](null),A&&A.d(),D&&D.d(),e[58](null),E&&E.d(R),M=!1,he(J)}}}const en=70,we=0,Me=500,mt=45,Tt=45;function nn(e){const{values:n,nFreqs:t,nTimes:s}=e;if(s<=0||t<=0||!n||n.length===0)return console.warn("Invalid spectrogram data:",{nTimes:s,nFreqs:t,valuesLength:n==null?void 0:n.length}),null;const r=new ImageData(s,t);let l=-1/0;for(let h=0;h<n.length;h++)n[h]>l&&(l=n[h]);const a=10*Math.log10(l+1e-10);for(let h=0;h<s;h++)for(let m=0;m<t;m++){const x=n[m*s+h],g=10*Math.log10(x+1e-10),b=Math.max(0,Math.min(1,(g-(a-en))/en)),c=Math.round(255*(1-b)),_=((t-1-m)*s+h)*4;r.data[_]=c,r.data[_+1]=c,r.data[_+2]=c,r.data[_+3]=255}const u=document.createElement("canvas");return u.width=s,u.height=t,u.getContext("2d").putImageData(r,0,0),{imageData:r,canvas:u}}function Ns(e,n,t){let s,r,l,a,u,d,h,m,x,g,b,c,_,B,N,M,J,P,A,D,E;nt(e,Ht,i=>t(69,m=i)),nt(e,Lt,i=>t(42,x=i)),nt(e,Ot,i=>t(1,g=i)),nt(e,wt,i=>t(43,b=i)),nt(e,me,i=>t(8,c=i)),nt(e,ye,i=>t(2,_=i)),nt(e,Jt,i=>t(44,B=i)),nt(e,ne,i=>t(45,N=i)),nt(e,Ve,i=>t(70,M=i)),nt(e,Dt,i=>t(46,J=i)),nt(e,Bt,i=>t(47,P=i)),nt(e,fe,i=>t(48,A=i)),nt(e,xe,i=>t(49,D=i)),nt(e,ln,i=>t(50,E=i));let{showPitch:R=!0}=n,{showFormants:H=!0}=n,{showIntensity:at=!1}=n,{showHNR:L=!1}=n,{showCoG:Ct=!1}=n,{showSpectralTilt:kt=!1}=n,{showA1P0:k=!1}=n,{showDataPoints:Z=!0}=n,{maxFreq:z=5e3}=n,K,X,o=null,U=0,C=0,vt,rt=null,se=null,St=null,ot=null,tt=null,ht=null,O=!1,it=0,V=!1,ct=null,yt=null,Ft=null;function oe(i,f){ht&&clearTimeout(ht);const p=f-i;if(r&&!rt){if(p>Vt){t(35,ot=null),tt=null;return}if(tt&&(Math.min(f,tt.end)-Math.max(i,tt.start))/p>.9)return;ht=setTimeout(async()=>{await fs(i,f),Rt(i,f)},300);return}if(!rt)return;if((rt.timeMax-rt.timeMin)/p<2){t(35,ot=null),tt=null;return}tt&&(Math.min(f,tt.end)-Math.max(i,tt.start))/p>.9||(ht=setTimeout(()=>{Rt(i,f)},300))}async function Rt(i,f){if(!x||!A||!rt&&!r)return;const p=Se(),S=(f-i)*.05,y=Math.max(0,i-S),v=Math.min(x.length/m,f+S),w=Math.floor(y*m),T=Math.ceil(v*m),I=x.slice(w,T),W=new p.Sound(I,m);try{const j=Math.max(.001,(v-y)/(u*2)),et=_e(W,.005,z,j,20),Y=Pe(et),It={values:Y.values,freqMin:Y.freqMin,freqMax:Y.freqMax,timeMin:y,timeMax:Y.timeMax,nFreqs:Y.nFreqs,nTimes:Y.nTimes},_t=nn(It);_t&&(t(35,ot=_t.canvas),tt={start:y,end:v}),et.free(),de()}finally{W.free()}}We(()=>{t(32,o=X.getContext("2d")),vt=new ResizeObserver(i=>{const f=i[0].contentRect;t(33,U=f.width),C=f.height,t(4,X.width=U*devicePixelRatio,X),t(4,X.height=C*devicePixelRatio,X),o&&o.scale(devicePixelRatio,devicePixelRatio),de()}),vt.observe(K)}),Oe(()=>{vt==null||vt.disconnect(),ht&&clearTimeout(ht)});async function Zt(){if(!x||!A)return;const i=Se(),f=new i.Sound(x,m);try{const p=_e(f,.005,z,.002,20),S=Pe(p);t(0,rt={values:S.values,freqMin:S.freqMin,freqMax:S.freqMax,timeMin:S.timeMin,timeMax:S.timeMax,nFreqs:S.nFreqs,nTimes:S.nTimes}),t(36,Ft=z),t(35,ot=null),tt=null;const y=nn(rt);y&&(se=y.imageData,t(34,St=y.canvas)),p.free(),await ns();const v=()=>{U>0&&o?de():requestAnimationFrame(v)};requestAnimationFrame(v)}finally{f.free()}}function de(){if(!o||U===0)return;const{start:i,end:f}=b,p=M.colors;t(32,o.fillStyle=getComputedStyle(K).getPropertyValue("--color-bg").trim()||"#1a1a1a",o),o.fillRect(0,0,U,C),t(32,o.fillStyle=getComputedStyle(K).getPropertyValue("--color-surface").trim()||"#2a2a2a",o),o.fillRect(0,0,mt,C),o.fillRect(U-Tt,0,Tt,C);const S=ot&&tt&&i>=tt.start&&f<=tt.end;if(l&&!S)t(32,o.fillStyle="rgba(255, 255, 255, 0.6)",o),t(32,o.font="14px sans-serif",o),t(32,o.textAlign="center",o),t(32,o.textBaseline="middle",o),o.fillText("Zoom in for spectrogram",mt+u/2,C/2);else if(S&&ot&&tt){const w=ot,T=tt.start,I=tt.end,W=w.width,j=w.height,et=Math.floor((i-T)/(I-T)*W),Y=Math.ceil((f-i)/(I-T)*W);t(32,o.imageSmoothingEnabled=!0,o),o.drawImage(w,Math.max(0,et),0,Math.min(Y,W-et),j,mt,0,u,C)}else if(rt&&St){const{timeMin:w,timeMax:T,nTimes:I,nFreqs:W,freqMax:j}=rt,et=Math.floor((i-w)/(T-w)*I),Y=Math.ceil((f-i)/(T-w)*I),It=Math.min(1,z/j),_t=Math.floor(W*It),Kt=W-_t;t(32,o.imageSmoothingEnabled=!1,o),o.drawImage(St,Math.max(0,et),Kt,Math.min(Y,I-et),_t,mt,0,u,C)}if(g){const w=Math.max(g.start,i),T=Math.min(g.end,f);if(T>w){const I=xt(w,i,f),W=xt(T,i,f);t(32,o.fillStyle=p.selection.fill,o),o.fillRect(I,0,W-I,C)}}if(P!==null){const w=xt(P,i,f);w>=mt&&w<=d&&(t(32,o.strokeStyle=p.cursor,o),t(32,o.lineWidth=1,o),o.setLineDash([4,4]),o.beginPath(),o.moveTo(w,0),o.lineTo(w,C),o.stroke(),o.setLineDash([]))}const v=xt(J,i,f);v>=mt&&v<=d&&(t(32,o.strokeStyle=p.cursor,o),t(32,o.lineWidth=p.cursorWidth,o),o.beginPath(),o.moveTo(v,0),o.lineTo(v,C),o.stroke()),N&&(R&&kn(i,f),H&&Nn(i,f),at&&An(i,f),L&&Dn(i,f),Ct&&Cn(i,f),kt&&Fn(i,f),k&&Rn(i,f)),Z&&In(i,f),_n(),R&&Pn()}function _n(){if(!o)return;t(32,o.fillStyle="rgba(255, 255, 255, 0.8)",o),t(32,o.font="10px sans-serif",o),t(32,o.textAlign="right",o);const i=z<=5e3?1e3:z<=7500?1500:2e3;for(let f=0;f<=z;f+=i){const p=C-f/z*C,S=f>=1e3?`${f/1e3}k`:`${f}`;o.fillText(S,mt-4,p+3),t(32,o.strokeStyle="rgba(255, 255, 255, 0.3)",o),t(32,o.lineWidth=1,o),o.beginPath(),o.moveTo(mt-2,p),o.lineTo(mt,p),o.stroke()}o.save(),o.translate(12,C/2),o.rotate(-Math.PI/2),t(32,o.textAlign="center",o),t(32,o.fillStyle="rgba(255, 255, 255, 0.6)",o),t(32,o.font="9px sans-serif",o),o.fillText("Frequency (Hz)",0,0),o.restore()}function Pn(){if(!o)return;t(32,o.fillStyle="#60a5fa",o),t(32,o.font="10px sans-serif",o),t(32,o.textAlign="left",o);const i=100;for(let f=0;f<=Me;f+=i){const p=Re(f);o.fillText(`${f}`,U-Tt+4,p+3),t(32,o.strokeStyle="rgba(96, 165, 250, 0.3)",o),t(32,o.lineWidth=1,o),o.beginPath(),o.moveTo(U-Tt,p),o.lineTo(U-Tt+2,p),o.stroke()}o.save(),o.translate(U-8,C/2),o.rotate(Math.PI/2),t(32,o.textAlign="center",o),t(32,o.fillStyle="rgba(96, 165, 250, 0.6)",o),t(32,o.font="9px sans-serif",o),o.fillText("Pitch (Hz)",0,0),o.restore()}function kn(i,f){if(!o||!N)return;const{times:p,pitch:S}=N,y=M.colors;t(32,o.strokeStyle=y.pitch,o),t(32,o.lineWidth=y.pitchWidth,o),o.beginPath();let v=!1;for(let w=0;w<p.length;w++){const T=p[w],I=S[w];if(T<i||T>f)continue;if(I===null||I<=we||I>Me){v=!1;continue}const W=xt(T,i,f),j=Re(I);v?o.lineTo(W,j):(o.moveTo(W,j),v=!0)}o.stroke(),t(32,o.fillStyle=y.pitch,o);for(let w=0;w<p.length;w++){const T=p[w],I=S[w];if(T<i||T>f||I===null||I<=we||I>Me)continue;const W=xt(T,i,f),j=Re(I);o.beginPath(),o.arc(W,j,2,0,Math.PI*2),o.fill()}}function Nn(i,f){if(!o||!N)return;const{times:p,formants:S}=N,y=M.colors.formant,v=[y.f1,y.f2,y.f3,y.f4],w=[S.f1,S.f2,S.f3,S.f4];for(let T=0;T<4;T++){const I=w[T];t(32,o.fillStyle=v[T],o);for(let W=0;W<p.length;W++){const j=p[W],et=I[W];if(j<i||j>f||et===null||et>z)continue;const Y=xt(j,i,f),It=Fe(et);o.beginPath(),o.arc(Y,It,y.size,0,Math.PI*2),o.fill()}}}function An(i,f){if(!o||!N)return;const{times:p,intensity:S}=N;t(32,o.strokeStyle="#4ade80",o),t(32,o.lineWidth=2,o),o.beginPath();let y=!1;const v=30,w=90;for(let T=0;T<p.length;T++){const I=p[T],W=S[T];if(I<i||I>f)continue;if(W===null){y=!1;continue}const j=xt(I,i,f),et=(W-v)/(w-v),Y=C-et*C*.8-C*.1;y?o.lineTo(j,Y):(o.moveTo(j,Y),y=!0)}o.stroke()}function Dn(i,f){if(!o||!N)return;const{times:p,harmonicity:S}=N;t(32,o.strokeStyle="#fbbf24",o),t(32,o.lineWidth=2,o),o.beginPath();let y=!1;const v=-10,w=40;for(let T=0;T<p.length;T++){const I=p[T],W=S[T];if(I<i||I>f)continue;if(W===null){y=!1;continue}const j=xt(I,i,f),et=(W-v)/(w-v),Y=C-et*C*.8-C*.1;y?o.lineTo(j,Y):(o.moveTo(j,Y),y=!0)}o.stroke()}function Cn(i,f){if(!o||!N||!N.cog)return;const{times:p,cog:S}=N;t(32,o.fillStyle="#c084fc",o);for(let y=0;y<p.length;y++){const v=p[y],w=S[y];if(v<i||v>f||w===null||w>z)continue;const T=xt(v,i,f),I=Fe(w);o.beginPath(),o.arc(T,I,2.5,0,Math.PI*2),o.fill()}}function Fn(i,f){if(!o||!N||!N.spectralTilt)return;const{times:p,spectralTilt:S}=N;t(32,o.strokeStyle="#22d3ee",o),t(32,o.lineWidth=2,o),o.beginPath();let y=!1;const v=0,w=40;for(let T=0;T<p.length;T++){const I=p[T],W=S[T];if(I<i||I>f)continue;if(W===null){y=!1;continue}const j=xt(I,i,f),et=(W-v)/(w-v),Y=C-et*C*.8-C*.1;y?o.lineTo(j,Y):(o.moveTo(j,Y),y=!0)}o.stroke()}function Rn(i,f){if(!o||!N||!N.a1p0)return;const{times:p,a1p0:S}=N;t(32,o.strokeStyle="#fb7185",o),t(32,o.lineWidth=2,o),o.beginPath();let y=!1;const v=-20,w=20;for(let T=0;T<p.length;T++){const I=p[T],W=S[T];if(I<i||I>f)continue;if(W===null){y=!1;continue}const j=xt(I,i,f),et=(W-v)/(w-v),Y=C-et*C*.8-C*.1;y?o.lineTo(j,Y):(o.moveTo(j,Y),y=!0)}o.stroke()}function In(i,f){if(!o)return;const p=B;for(const S of p){if(S.time<i||S.time>f)continue;const y=xt(S.time,i,f),v=Fe(S.frequency),w=_===S.id;t(32,o.strokeStyle=w?"#ff6b6b":"#ffcc00",o),t(32,o.lineWidth=w?2:1,o),o.setLineDash([3,3]),o.beginPath(),o.moveTo(y,0),o.lineTo(y,C),o.stroke(),o.setLineDash([]),t(32,o.fillStyle=w?"#ff6b6b":"#ffcc00",o),o.beginPath(),o.arc(y,v,w?6:4,0,Math.PI*2),o.fill(),t(32,o.strokeStyle="#000",o),t(32,o.lineWidth=1,o),o.beginPath(),o.arc(y,v,w?6:4,0,Math.PI*2),o.stroke(),t(32,o.fillStyle="#ffcc00",o),t(32,o.font="10px sans-serif",o),t(32,o.textAlign="center",o),o.fillText(`P${S.id}`,y,12)}}function Fe(i){return C-i/z*C}function pe(i){return(1-i/C)*z}function Re(i){return C-(i-we)/(Me-we)*C}function xt(i,f,p){return mt+(i-f)/(p-f)*u}function re(i,f,p){return f+(i-mt)/u*(p-f)}function qn(i){document.activeElement instanceof HTMLInputElement&&document.activeElement.blur();const f=X.getBoundingClientRect(),p=i.clientX-f.left,S=i.clientY-f.top;if(p<mt||p>U-Tt)return;const y=re(p,b.start,b.end),v=pe(S);if(Z){const w=be(y,v,.02,z*.05);if(w){Yt(),t(5,V=!0),ct=w.id,xe.set(w.id);return}}O=!0,it=y,Dt.set(y),Ot.set(null)}function zn(i){const f=X.getBoundingClientRect(),p=i.clientX-f.left,S=i.clientY-f.top;if(p<mt||p>U-Tt){Bt.set(null),V||ye.set(null);return}const y=re(p,b.start,b.end),v=pe(S);if(Bt.set(y),V&&ct!==null){vs(ct,y,v);return}if(Z){const w=be(y,v,.02,z*.05);ye.set((w==null?void 0:w.id)??null)}O&&(Math.abs(y-it)>.001&&Ot.set({start:Math.min(it,y),end:Math.max(it,y)}),Dt.set(y))}function Bn(){V&&(t(5,V=!1),ct=null,xe.set(null)),O=!1}function En(){V&&(t(5,V=!1),ct=null,xe.set(null)),O=!1,Bt.set(null),ye.set(null)}function Wn(i){if(!Z)return;const f=X.getBoundingClientRect(),p=i.clientX-f.left,S=i.clientY-f.top;if(p<mt||p>U-Tt)return;const y=re(p,b.start,b.end),v=pe(S);be(y,v,.02,z*.05)||Tn(y,v)}function On(i){if(!Z)return;const f=X.getBoundingClientRect(),p=i.clientX-f.left,S=i.clientY-f.top;if(p<mt||p>U-Tt)return;const y=re(p,b.start,b.end),v=pe(S),w=be(y,v,.02,z*.05);w&&(i.preventDefault(),t(6,yt={x:i.clientX,y:i.clientY,pointId:w.id}))}function Ye(){t(6,yt=null)}function Ln(){yt&&(Ms(yt.pointId),t(6,yt=null))}function Hn(i){i.preventDefault();const f=X.getBoundingClientRect(),p=i.clientX-f.left,S=re(p,b.start,b.end),y=x?x.length/m:10,{start:v,end:w}=b,T=w-v;if(Math.abs(i.deltaX)>Math.abs(i.deltaY)){const It=i.deltaX/u*T;let _t=v+It,Kt=w+It;_t<0&&(_t=0,Kt=T),Kt>y&&(Kt=y,_t=y-T),wt.set({start:_t,end:Kt});return}const I=i.deltaY>0?1.1:.91,W=Math.max(.01,Math.min(y,T*I)),j=(S-v)/T,et=Math.max(0,S-j*W),Y=Math.min(y,et+W);wt.set({start:Math.max(0,Y-W),end:Y})}function Vn(){g&&(c?Ne():Xe(g.start,g.end))}function Xn(){const i=x?x.length/m:10,{start:f,end:p}=b,S=p-f,y=(f+p)/2,v=Math.max(.01,S*.7),w=Math.max(0,y-v/2),T=Math.min(i,w+v);wt.set({start:Math.max(0,T-v),end:T})}function jn(){const i=x?x.length/m:10,{start:f,end:p}=b,S=p-f,y=(f+p)/2,v=Math.min(i,S*1.4),w=Math.max(0,y-v/2),T=Math.min(i,w+v);wt.set({start:Math.max(0,T-v),end:T})}function Gn(){if(!g)return;const i=(g.end-g.start)*.1,f=x?x.length/m:10;wt.set({start:Math.max(0,g.start-i),end:Math.min(f,g.end+i)})}function Un(){const i=x?x.length/m:10;wt.set({start:0,end:i})}function Yn(i){ie.call(this,e,i)}function Jn(i){ie.call(this,e,i)}function Zn(i){ie.call(this,e,i)}function Kn(i){ie.call(this,e,i)}function Qn(i){ie.call(this,e,i)}const $n=i=>i.key==="Escape"&&yt&&Ye();function ts(i){ee[i?"unshift":"push"](()=>{X=i,t(4,X)})}function es(i){ee[i?"unshift":"push"](()=>{K=i,t(3,K)})}return e.$$set=i=>{"showPitch"in i&&t(23,R=i.showPitch),"showFormants"in i&&t(24,H=i.showFormants),"showIntensity"in i&&t(25,at=i.showIntensity),"showHNR"in i&&t(26,L=i.showHNR),"showCoG"in i&&t(27,Ct=i.showCoG),"showSpectralTilt"in i&&t(28,kt=i.showSpectralTilt),"showA1P0"in i&&t(29,k=i.showA1P0),"showDataPoints"in i&&t(30,Z=i.showDataPoints),"maxFreq"in i&&t(31,z=i.maxFreq)},e.$$.update=()=>{e.$$.dirty[1]&4096&&t(41,s=b.end-b.start),e.$$.dirty[1]&524288&&t(39,r=E>Vt),e.$$.dirty[1]&1280&&t(38,l=r&&s>Vt),e.$$.dirty[0]&1|e.$$.dirty[1]&133409&&x&&A&&!r&&(!rt||z!==Ft)&&Zt(),e.$$.dirty[0]&2139095046|e.$$.dirty[1]&389279&&t(40,a=[o,St,ot,U,b,g,J,P,N,B,_,D,z,R,H,at,L,Ct,kt,k,Z,l]),e.$$.dirty[1]&670&&a&&o&&U>0&&(St||l||ot)&&de(),e.$$.dirty[1]&4&&t(37,u=Math.max(0,U-mt-Tt)),e.$$.dirty[0]&1|e.$$.dirty[1]&137536&&b&&x&&A&&u>0&&(rt||r)&&oe(b.start,b.end),e.$$.dirty[1]&4&&(d=U-Tt),e.$$.dirty[0]&2|e.$$.dirty[1]&4100&&t(7,h=g&&U>0?xt(Math.max(g.start,b.start),b.start,b.end):0)},[rt,g,_,K,X,V,yt,h,c,qn,zn,Bn,En,Wn,On,Ye,Ln,Hn,Vn,Xn,jn,Gn,Un,R,H,at,L,Ct,kt,k,Z,z,o,U,St,ot,Ft,u,l,r,a,s,x,b,B,N,J,P,A,D,E,Yn,Jn,Zn,Kn,Qn,$n,ts,es]}class oo extends Le{constructor(n){super(),He(this,n,Ns,ks,Ee,{showPitch:23,showFormants:24,showIntensity:25,showHNR:26,showCoG:27,showSpectralTilt:28,showA1P0:29,showDataPoints:30,maxFreq:31},null,[-1,-1,-1])}}function As(e){let n,t;return{c(){n=pt("div"),t=pt("canvas"),this.h()},l(s){n=dt(s,"DIV",{class:!0});var r=gt(n);t=dt(r,"CANVAS",{class:!0}),gt(t).forEach(G),r.forEach(G),this.h()},h(){q(t,"class","svelte-1ubvkuo"),q(n,"class","time-axis svelte-1ubvkuo")},m(s,r){Mt(s,n,r),ut(n,t),e[5](t),e[6](n)},p:At,i:At,o:At,d(s){s&&G(n),e[5](null),e[6](null)}}}let sn=24;function Ds(e,n){if(n>=60){const t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s.toString().padStart(2,"0")}`}else return n>=1?e.toFixed(0)+"s":n>=.1?e.toFixed(1):n>=.01?e.toFixed(2):e.toFixed(3)}function Cs(e,n,t){let s;nt(e,wt,g=>t(4,s=g));let r,l,a=null,u=0,d;We(()=>{t(2,a=l.getContext("2d")),d=new ResizeObserver(g=>{const b=g[0].contentRect;t(3,u=b.width),t(1,l.width=u*devicePixelRatio,l),t(1,l.height=sn*devicePixelRatio,l),a&&a.scale(devicePixelRatio,devicePixelRatio),h()}),d.observe(r)}),Oe(()=>{d==null||d.disconnect()});function h(){if(!a||u===0)return;const{start:g,end:b}=s,c=b-g;t(2,a.fillStyle="#2d2d2d",a),a.fillRect(0,0,u,sn);const _=Math.floor(u/80),B=c/_;let M=[.001,.002,.005,.01,.02,.05,.1,.2,.5,1,2,5,10,30,60].find(A=>A>=B)||60;t(2,a.strokeStyle="#606060",a),t(2,a.fillStyle="#a0a0a0",a),t(2,a.font="10px sans-serif",a),t(2,a.textAlign="center",a);const J=Math.ceil(g/M)*M;for(let A=J;A<=b;A+=M){const D=(A-g)/c*u;a.beginPath(),a.moveTo(D,0),a.lineTo(D,6),a.stroke();const E=Ds(A,M);a.fillText(E,D,18)}const P=M/5;if(P>=.001){t(2,a.strokeStyle="#404040",a);const A=Math.ceil(g/P)*P;for(let D=A;D<=b;D+=P){const E=(D-g)/c*u;a.beginPath(),a.moveTo(E,0),a.lineTo(E,3),a.stroke()}}}function m(g){ee[g?"unshift":"push"](()=>{l=g,t(1,l)})}function x(g){ee[g?"unshift":"push"](()=>{r=g,t(0,r)})}return e.$$.update=()=>{e.$$.dirty&28&&a&&u>0&&s&&h()},[r,l,a,u,s,m,x]}class ro extends Le{constructor(n){super(),He(this,n,Cs,As,Ee,{})}}export{js as A,Gs as B,eo as C,Us as D,Ys as E,ws as F,Zs as G,Js as H,ft as I,Vs as J,no as K,so as L,qe as M,Jt as N,Xs as O,oo as S,ro as T,Es as W,Lt as a,Dt as b,Ls as c,ln as d,Ot as e,Bs as f,ne as g,me as h,Ws as i,ke as j,st as k,Ne as l,Xe as m,Gt as n,Yt as o,Hs as p,Qs as q,Os as r,Ht as s,wt as t,Bt as u,to as v,fe as w,bs as x,Ks as y,$s as z};
